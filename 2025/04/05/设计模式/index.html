<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>设计模式 | XYJ</title><meta name="author" content="XYJ"><meta name="copyright" content="XYJ"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="设计模式讲的是如何写出可扩展、可读、可维护的⾼质量代码，所以，它们跟平时的编码会有直接的关系，也会直 接影响到你的开发能⼒。 什么是面向对象编程？⾯向对象编程的英⽂缩写是 OOP，全称是 Object Oriented Programming。对应地，⾯向对象编程语⾔的英⽂缩 写是 OOPL，全称是 Object Oriented Programming Language。 ⾯向对象编程中有两个⾮">
<meta property="og:type" content="article">
<meta property="og:title" content="设计模式">
<meta property="og:url" content="https://troublingrainblue.github.io/2025/04/05/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/index.html">
<meta property="og:site_name" content="XYJ">
<meta property="og:description" content="设计模式讲的是如何写出可扩展、可读、可维护的⾼质量代码，所以，它们跟平时的编码会有直接的关系，也会直 接影响到你的开发能⼒。 什么是面向对象编程？⾯向对象编程的英⽂缩写是 OOP，全称是 Object Oriented Programming。对应地，⾯向对象编程语⾔的英⽂缩 写是 OOPL，全称是 Object Oriented Programming Language。 ⾯向对象编程中有两个⾮">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://cdn.acwing.com/media/article/image/2025/04/05/104918_97006f7411-b_f45a1ac4a80690a8b277e50e05c5ddf7.jpg">
<meta property="article:published_time" content="2025-04-05T04:26:19.000Z">
<meta property="article:modified_time" content="2025-04-07T06:27:08.702Z">
<meta property="article:author" content="XYJ">
<meta property="article:tag" content="java">
<meta property="article:tag" content="设计模式">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://cdn.acwing.com/media/article/image/2025/04/05/104918_97006f7411-b_f45a1ac4a80690a8b277e50e05c5ddf7.jpg"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://troublingrainblue.github.io/2025/04/05/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":false,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '设计模式',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2025-04-07 14:27:08'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
    win.getCSS = (url,id = false) => new Promise((resolve, reject) => {
      const link = document.createElement('link')
      link.rel = 'stylesheet'
      link.href = url
      if (id) link.id = id
      link.onerror = reject
      link.onload = link.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        link.onload = link.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(link)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><meta name="generator" content="Hexo 6.3.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/img/favicon.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">30</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">17</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">11</div></a></div><hr class="custom-hr"/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首頁</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 時間軸</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 標籤</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分類</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fa fa-heartbeat"></i><span> 清單</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> 音樂</span></a></li><li><a class="site-page child" href="/Gallery/"><i class="fa-fw fas fa-images"></i><span> 照片</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 電影</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友鏈</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 關於</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://cdn.acwing.com/media/article/image/2025/04/05/104918_97006f7411-b_f45a1ac4a80690a8b277e50e05c5ddf7.jpg')"><nav id="nav"><span id="blog-info"><a href="/" title="XYJ"><span class="site-name">XYJ</span></a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首頁</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 時間軸</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 標籤</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分類</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fa fa-heartbeat"></i><span> 清單</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> 音樂</span></a></li><li><a class="site-page child" href="/Gallery/"><i class="fa-fw fas fa-images"></i><span> 照片</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 電影</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友鏈</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 關於</span></a></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">设计模式</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2025-04-05T04:26:19.000Z" title="发表于 2025-04-05 12:26:19">2025-04-05</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2025-04-07T06:27:08.702Z" title="更新于 2025-04-07 14:27:08">2025-04-07</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/java/">java</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">25.7k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>90分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="设计模式"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><p>设计模式讲的是如何写出可扩展、可读、可维护的⾼质量代码，所以，它们跟平时的编码会有直接的关系，也会直 接影响到你的开发能⼒。</p>
<h1 id="什么是面向对象编程？"><a href="#什么是面向对象编程？" class="headerlink" title="什么是面向对象编程？"></a>什么是面向对象编程？</h1><p>⾯向对象编程的英⽂缩写是 OOP，全称是 Object Oriented Programming。对应地，⾯向对象编程语⾔的英⽂缩 写是 OOPL，全称是 Object Oriented Programming Language。 ⾯向对象编程中有两个⾮常重要、⾮常基础的概念，那就是类（class）和对象（object）。这两个概念最早出现在  1960 年，在 Simula 这种编程语⾔中第⼀次使⽤。⽽⾯向对象编程这个概念第⼀次被使⽤是在 Smalltalk 这种编程 语⾔中。Smalltalk 被认为是第⼀个真正意义上的⾯向对象编程语⾔。 如果⾮得给出⼀个定义的话，我觉得可以⽤下⾯两句话来概括 ⾯向对象编程是⼀种编程范式或编程⻛格。</p>
<ul>
<li>它以类或对象作为组织代码的基本单元，并将封装、抽象、继 承、多态四个特性，作为代码设计和实现的基⽯ 。</li>
<li>⾯向对象编程语⾔是⽀持类或对象的语法机制，并有现成的语法机制，能⽅便地实现⾯向对象编程四⼤特性 （封装、抽象、继承、多态）的编程语⾔。</li>
</ul>
<p>⾯向对象编程是⼀种编程范式或编程⻛格。它以类或对象作为组织代码的基本单元，并将封装、抽象、继承、多态 四个特性，作为代码设计和实现的基⽯。</p>
<p>⾯向对象编程语⾔是⽀持类或对象的语法机制，并有现成的语法机制，能⽅便地实现⾯向对象编程四⼤特性（封 装、抽象、继承、多态）的编程语⾔。</p>
<p>如果按照严格的的定义，需要有现成的语法⽀持类、对象、四⼤特性才能叫作⾯向对象编程语⾔。如果放宽要求的 话，只要某种编程语⾔⽀持类、对象语法机制，那基本上就可以说这种编程语⾔是⾯向对象编程语⾔了，不⼀定⾮ 得要求具有所有的四⼤特性。</p>
<h2 id="面向对象的四大特性"><a href="#面向对象的四大特性" class="headerlink" title="面向对象的四大特性"></a>面向对象的四大特性</h2><h3 id="封装"><a href="#封装" class="headerlink" title="封装"></a>封装</h3><p>封装也叫作信息隐藏或者数据访问保护。类通过暴露有限的访问接⼝，授权外部仅能通过类提供的⽅式来访问内部 信息或者数据。它需要编程语⾔提供权限访问控制语法来⽀持，例如 Java 中的 private、protected、public 关键 字。封装特性存在的意义，⼀⽅⾯是保护数据不被随意修改，提⾼代码的可维护性；另⼀⽅⾯是仅暴露有限的必要 接⼝，提⾼类的易⽤性。</p>
<h3 id="抽象"><a href="#抽象" class="headerlink" title="抽象"></a>抽象</h3><p>封装主要讲如何隐藏信息、保护数据，那抽象就是讲如何隐藏⽅法的具体实现，让使⽤者只需要关⼼⽅法提供了哪 些功能，不需要知道这些功能是如何实现的。抽象可以通过接⼝类或者抽象类来实现，但也并不需要特殊的语法机 制来⽀持。抽象存在的意义，⼀⽅⾯是提⾼代码的可扩展性、维护性，修改实现不需要改变定义，减少代码的改动 范围；另⼀⽅⾯，它也是处理复杂系统的有效⼿段，能有效地过滤掉不必要关注的信息。</p>
<h3 id="继承"><a href="#继承" class="headerlink" title="继承"></a>继承</h3><p>继承是⽤来表示类之间的 is-a 关系，分为两种模式：单继承和多继承。单继承表示⼀个⼦类只继承⼀个⽗类，多继 承表示⼀个⼦类可以继承多个⽗类。为了实现继承这个特性，编程语⾔需要提供特殊的语法机制来⽀持。继承主要 是⽤来解决代码复⽤的问题。</p>
<h3 id="多态"><a href="#多态" class="headerlink" title="多态"></a>多态</h3><p>多态是指⼦类可以替换⽗类，在实际的代码运⾏过程中，调⽤⼦类的⽅法实现。多态这种特性也需要编程语⾔提供 特殊的语法机制来实现，⽐如继承、接⼝类、duck-typing。多态可以提⾼代码的扩展性和复⽤性，是很多设计模 式、设计原则、编程技巧的代码实现基础。</p>
<h2 id="抽象类和接口"><a href="#抽象类和接口" class="headerlink" title="抽象类和接口"></a>抽象类和接口</h2><h3 id="抽象类"><a href="#抽象类" class="headerlink" title="抽象类"></a>抽象类</h3><ul>
<li>抽象类不允许被实例化，只能被继承。也就是说，你不能 new ⼀个抽象类的对象出来（Logger logger &#x3D;  new Logger(…); 会报编译错误）。</li>
<li>抽象类可以包含属性和⽅法。⽅法既可以包含代码实现（⽐如 Logger 中的 log() ⽅法），也可以不包含代码 实现（⽐如 Logger 中的 doLog() ⽅法）。不包含代码实现的⽅法叫作抽象⽅法。</li>
<li>⼦类继承抽象类，必须实现抽象类中的所有抽象⽅法。对应到例⼦代码中就是，所有继承 Logger 抽象类的⼦ 类，都必须重写 doLog() ⽅法。</li>
</ul>
<h3 id="接口特性"><a href="#接口特性" class="headerlink" title="接口特性"></a>接口特性</h3><ul>
<li>接⼝不能包含属性（也就是成员变量）。</li>
<li>接⼝只能声明⽅法，⽅法不能包含代码实现。</li>
<li>类实现接⼝的时候，必须实现接⼝中声明的所有⽅法。</li>
</ul>
<p>抽象类实际上就是类，只不过是⼀种特殊的类，这种类不能被实例化为对象，只能被⼦类继承。我们知道，继承关 系是⼀种 is-a 的关系，那抽象类既然属于类，也表示⼀种 is-a 的关系。相对于抽象类的 is-a 关系来说，接⼝表示 ⼀种 has-a 关系，表示具有某些功能。对于接⼝，有⼀个更加形象的叫法，那就是协议（contract）。</p>
<h3 id="应用场景"><a href="#应用场景" class="headerlink" title="应用场景"></a>应用场景</h3><p>抽象类更多的是为了代码复⽤，⽽接⼝就更侧重于解耦。接⼝是对⾏为的⼀种抽象，相当于⼀组协议或者契约，你 可以联想类⽐⼀下 API 接⼝。调⽤者只需要关注抽象的接⼝，不需要了解具体的实现，具体的实现代码对调⽤者透 明。接⼝实现了约定和实现相分离，可以降低代码间的耦合性，提⾼代码的可扩展性。 </p>
<p>抽象类是对成员变量和⽅法的抽象，是⼀种 is-a 关系，是为了解决代码复⽤问题。接⼝仅仅是对⽅法的抽象，是⼀ 种 has-a 关系，表示具有某⼀组⾏为特性，是为了解决解耦问题，隔离接⼝和具体的实现，提⾼代码的扩展性。如果要表示⼀种 is-a 的关系，并且是为了 解决代码复⽤问题，我们就⽤抽象类；如果要表示 ⼀种 has-a 关系，并且是为了解决抽象⽽⾮代码复⽤问题，那我 们就⽤接⼝。</p>
<h3 id="基于接口而非实现编程"><a href="#基于接口而非实现编程" class="headerlink" title="基于接口而非实现编程"></a>基于接口而非实现编程</h3><p>“基于接⼝⽽⾮实现编程”这条原则的另⼀个表述⽅式，是“基于抽象⽽⾮实现编程”。后者的表述⽅式 其实更能体现这条原则的设计初衷。在软件开发中，最⼤的挑战之⼀就是需求的不断变化，这也是考验代码 设计好坏的⼀个标准。越抽象、越顶层、越脱离具体某⼀实现的设计，越能提⾼代码的灵活性，越能应对未 来的需求变化。好的代码设计，不仅能应对当下的需求，⽽且在将来需求发⽣变化的时候，仍然能够在不破 坏原有代码设计的情况下灵活应对。⽽抽象就是提⾼代码扩展性、灵活性、可维护性最有效的⼿段之⼀。</p>
<p>我们在定义接⼝的时候，⼀⽅⾯，命名要⾜够通⽤，不能包含跟具体实现相关的字眼；另⼀⽅⾯，与特定实 现有关的⽅法不要定义在接⼝中。 “基于接⼝⽽⾮实现编程”这条原则，不仅仅可以指导⾮常细节的编程开发，还能指导更加上层的架构设计、系 统设计等。⽐如，服务端与客户端之间的“接⼝”设计、类库的“接⼝”设计。</p>
<h2 id="为什么不推荐使用继承"><a href="#为什么不推荐使用继承" class="headerlink" title="为什么不推荐使用继承"></a>为什么不推荐使用继承</h2><p>继承是⾯向对象的四⼤特性之⼀，⽤来表示类之间的 is-a 关系，可以解决代码复⽤的问题。虽然继承有诸多作⽤， 但继承层次过深、过复杂，也会影响到代码的可维护性。在这种情况下，我们应该尽量少⽤，甚⾄不⽤继承。</p>
<p>继承主要有三个作⽤：表示 is-a 关系，⽀持多态特性，代码复⽤。⽽这三个作⽤都可以通过其他技术⼿段 来达成。⽐如 is-a 关系，我们可以通过组合和接⼝的 has-a 关系来替代；多态特性我们可以利⽤接⼝来实现；代码复⽤我们可以通过组合和委托来实现。所以，从理论上讲，通过组合、接⼝、委托三个技术⼿段，我们完全可以 替换掉继承，在项⽬中不⽤或者少⽤继承关系，特别是⼀些复杂的继承关系。</p>
<h1 id="设计模式的六大原则"><a href="#设计模式的六大原则" class="headerlink" title="设计模式的六大原则"></a>设计模式的六大原则</h1><p><strong>1、开闭原则（Open Close Principle）</strong></p>
<p>开闭原则的意思是：<strong>对扩展开放，对修改关闭</strong>。在程序需要进行拓展的时候，不能去修改原有的代码，实现一个热插拔的效果。简言之，是为了使程序的扩展性好，易于维护和升级。想要达到这样的效果，我们需要使用接口和抽象类，后面的具体设计中我们会提到这点。</p>
<p><strong>2、里氏代换原则（Liskov Substitution Principle）</strong></p>
<p>里氏代换原则是面向对象设计的基本原则之一。 里氏代换原则中说，任何基类可以出现的地方，子类一定可以出现。LSP 是继承复用的基石，只有当派生类可以替换掉基类，且软件单位的功能不受到影响时，基类才能真正被复用，而派生类也能够在基类的基础上增加新的行为。里氏代换原则是对开闭原则的补充。实现开闭原则的关键步骤就是抽象化，而基类与子类的继承关系就是抽象化的具体实现，所以里氏代换原则是对实现抽象化的具体步骤的规范。</p>
<p><strong>3、依赖倒转原则（Dependence Inversion Principle）</strong></p>
<p>这个原则是开闭原则的基础，具体内容：针对接口编程，依赖于抽象而不依赖于具体。</p>
<p><strong>4、接口隔离原则（Interface Segregation Principle）</strong></p>
<p>这个原则的意思是：使用多个隔离的接口，比使用单个接口要好。它还有另外一个意思是：降低类之间的耦合度。由此可见，其实设计模式就是从大型软件架构出发、便于升级和维护的软件设计思想，它强调降低依赖，降低耦合。</p>
<p><strong>5、迪米特法则，又称最少知道原则（Demeter Principle）</strong></p>
<p>最少知道原则是指：一个实体应当尽量少地与其他实体之间发生相互作用，使得系统功能模块相对独立。</p>
<p><strong>6、合成复用原则（Composite Reuse Principle）</strong></p>
<p>合成复用原则是指：尽量使用合成&#x2F;聚合的方式，而不是使用继承。</p>
<h1 id="工厂模式"><a href="#工厂模式" class="headerlink" title="工厂模式"></a>工厂模式</h1><p>在软件开发中，对象创建逻辑的复杂性可能导致代码重复、耦合度高、难以扩展。例如：</p>
<ul>
<li>直接通过 <code>new</code> 关键字实例化对象时，客户端代码需要依赖具体类名。</li>
<li>当新增或修改对象类型时，需要频繁修改客户端代码，违反<strong>开闭原则</strong>（对扩展开放，对修改关闭）。</li>
</ul>
<p>工厂模式通过<strong>封装对象创建过程</strong>，将客户端代码与具体类解耦，从而解决这一问题。</p>
<p>工厂模式是一种<strong>创建型设计模式</strong>，核心思想是通过一个公共接口（工厂类或工厂方法）创建对象，而无需暴露具体实现细节。<br>主要分为两种形式：</p>
<ol>
<li><strong>简单工厂模式</strong>：一个工厂类根据参数决定创建哪种对象。</li>
<li><strong>工厂方法模式</strong>：将对象创建延迟到子类，由子类实现工厂方法。</li>
</ol>
<h2 id="简单工厂模式"><a href="#简单工厂模式" class="headerlink" title="简单工厂模式"></a>简单工厂模式</h2><p>以创建不同几何图形为例子</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1. 定义抽象产品接口</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">Shape</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">draw</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. 具体产品实现</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Circle</span> <span class="keyword">implements</span> <span class="title class_">Shape</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">draw</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;绘制圆形&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Rectangle</span> <span class="keyword">implements</span> <span class="title class_">Shape</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">draw</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;绘制矩形&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3. 简单工厂类</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ShapeFactory</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> Shape <span class="title function_">createShape</span><span class="params">(String type)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="string">&quot;circle&quot;</span>.equalsIgnoreCase(type)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Circle</span>();</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="string">&quot;rectangle&quot;</span>.equalsIgnoreCase(type)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Rectangle</span>();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>(<span class="string">&quot;未知图形类型&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 4. 客户端调用</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Client</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">ShapeFactory</span> <span class="variable">factory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ShapeFactory</span>();</span><br><span class="line">        </span><br><span class="line">        <span class="type">Shape</span> <span class="variable">circle</span> <span class="operator">=</span> factory.createShape(<span class="string">&quot;circle&quot;</span>);</span><br><span class="line">        circle.draw(); <span class="comment">// 输出: 绘制圆形</span></span><br><span class="line">        </span><br><span class="line">        <span class="type">Shape</span> <span class="variable">rectangle</span> <span class="operator">=</span> factory.createShape(<span class="string">&quot;rectangle&quot;</span>);</span><br><span class="line">        rectangle.draw(); <span class="comment">// 输出: 绘制矩形</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>简单工厂模式不是一个正式的设计模式，但它是工厂模式的基础。它使用一个单独的工厂类来创建不同的对象，根据传入的参数决定创建哪种类型的对象。</p>
<h2 id="工厂方法模式"><a href="#工厂方法模式" class="headerlink" title="工厂方法模式"></a>工厂方法模式</h2><p>在简单工厂模式下，当需要新增一种产品（如新增 <code>Triangle</code> 三角形）时，必须修改工厂类中的 <code>createShape()</code> 方法，添加新的 <code>if-else</code> 分支，违反了开闭原则。同时，所有对象的创建逻辑集中在单个工厂类中。工厂类代码臃肿，难以维护（尤其是产品类型较多时）。</p>
<p>还是以创建几何图形为例子</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 抽象产品接口</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">Shape</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">draw</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体产品类：圆形</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Circle</span> <span class="keyword">implements</span> <span class="title class_">Shape</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">draw</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;绘制圆形&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体产品类：矩形</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Rectangle</span> <span class="keyword">implements</span> <span class="title class_">Shape</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">draw</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;绘制矩形&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 抽象工厂接口</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">ShapeFactory</span> &#123;</span><br><span class="line">    Shape <span class="title function_">createShape</span><span class="params">()</span>;  <span class="comment">// 工厂方法（由子类实现）</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 圆形工厂</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CircleFactory</span> <span class="keyword">implements</span> <span class="title class_">ShapeFactory</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Shape <span class="title function_">createShape</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Circle</span>();  <span class="comment">// 创建具体产品</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 矩形工厂</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">RectangleFactory</span> <span class="keyword">implements</span> <span class="title class_">ShapeFactory</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Shape <span class="title function_">createShape</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Rectangle</span>();  <span class="comment">// 创建具体产品</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Client</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">// 使用圆形工厂创建对象</span></span><br><span class="line">        <span class="type">ShapeFactory</span> <span class="variable">circleFactory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CircleFactory</span>();</span><br><span class="line">        <span class="type">Shape</span> <span class="variable">circle</span> <span class="operator">=</span> circleFactory.createShape();</span><br><span class="line">        circle.draw();  <span class="comment">// 输出: 绘制圆形</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 使用矩形工厂创建对象</span></span><br><span class="line">        <span class="type">ShapeFactory</span> <span class="variable">rectangleFactory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RectangleFactory</span>();</span><br><span class="line">        <span class="type">Shape</span> <span class="variable">rectangle</span> <span class="operator">=</span> rectangleFactory.createShape();</span><br><span class="line">        rectangle.draw();  <span class="comment">// 输出: 绘制矩形</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>工厂方法模式下，新增产品只需要扩展新的工厂类即可，不需要修改原有代码。以新增绘制三角形为例子：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 新增三角形产品</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Triangle</span> <span class="keyword">implements</span> <span class="title class_">Shape</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">draw</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;绘制三角形&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 新增三角形工厂</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">TriangleFactory</span> <span class="keyword">implements</span> <span class="title class_">ShapeFactory</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Shape <span class="title function_">createShape</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Triangle</span>(); <span class="comment">// 无需修改其他工厂类</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<table>
<thead>
<tr>
<th align="left"><strong>特性</strong></th>
<th align="left"><strong>简单工厂模式</strong></th>
<th align="left"><strong>工厂方法模式</strong></th>
</tr>
</thead>
<tbody><tr>
<td align="left"><strong>开闭原则</strong></td>
<td align="left">❌ 新增产品需修改工厂类</td>
<td align="left">✅ 新增产品只需扩展新工厂类</td>
</tr>
<tr>
<td align="left"><strong>耦合性</strong></td>
<td align="left">客户端依赖具体工厂类</td>
<td align="left">客户端依赖抽象接口，与具体工厂解耦</td>
</tr>
<tr>
<td align="left"><strong>代码维护性</strong></td>
<td align="left">工厂类臃肿，难以维护</td>
<td align="left">职责分离，每个工厂类轻量</td>
</tr>
<tr>
<td align="left"><strong>扩展性</strong></td>
<td align="left">扩展困难（需修改核心逻辑）</td>
<td align="left">扩展灵活（符合开放封闭原则）</td>
</tr>
<tr>
<td align="left"><strong>适用场景</strong></td>
<td align="left">产品类型固定且极少变化</td>
<td align="left">产品类型多且可能频繁扩展</td>
</tr>
</tbody></table>
<h2 id="作用"><a href="#作用" class="headerlink" title="作用"></a><strong>作用</strong></h2><ol>
<li><strong>解耦</strong>：客户端无需关注对象的创建过程，只需通过工厂接口获取对象。</li>
<li><strong>可维护性</strong>：新增产品类时，只需扩展工厂逻辑，无需修改客户端代码。</li>
<li><strong>复用性</strong>：将对象创建逻辑集中管理，避免重复代码。</li>
</ol>
<h2 id="使用场景"><a href="#使用场景" class="headerlink" title="使用场景"></a><strong>使用场景</strong></h2><ol>
<li>对象创建过程复杂（如依赖配置、环境参数等）。</li>
<li>需要统一管理对象的生命周期（如数据库连接池）。</li>
<li>系统需要支持多种类型的对象（如不同数据库驱动、不同主题的UI组件）。</li>
</ol>
<h1 id="抽象工厂模式"><a href="#抽象工厂模式" class="headerlink" title="抽象工厂模式"></a>抽象工厂模式</h1><p>抽象工厂模式用于创建 <strong>多个相关或依赖的产品族</strong>，而不仅仅是单一类型的产品。它强调 <strong>产品之间的组合关系</strong>，例如“不同主题的UI组件”（如按钮、文本框、对话框等需统一风格）。</p>
<p>还是以绘制几何图形为例：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 抽象产品1：形状</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">Shape</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">draw</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 抽象产品2：颜色</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">Color</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">fill</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体形状：圆形</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Circle</span> <span class="keyword">implements</span> <span class="title class_">Shape</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">draw</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;绘制圆形&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体形状：矩形</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Rectangle</span> <span class="keyword">implements</span> <span class="title class_">Shape</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">draw</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;绘制矩形&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体颜色：红色</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Red</span> <span class="keyword">implements</span> <span class="title class_">Color</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">fill</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;填充红色&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体颜色：蓝色</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Blue</span> <span class="keyword">implements</span> <span class="title class_">Color</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">fill</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;填充蓝色&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 抽象工厂接口</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">AbstractFactory</span> &#123;</span><br><span class="line">    Shape <span class="title function_">createShape</span><span class="params">()</span>;</span><br><span class="line">    Color <span class="title function_">createColor</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体工厂1：红色圆形风格</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">RedCircleFactory</span> <span class="keyword">implements</span> <span class="title class_">AbstractFactory</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Shape <span class="title function_">createShape</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Circle</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Color <span class="title function_">createColor</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Red</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体工厂2：蓝色矩形风格</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">BlueRectangleFactory</span> <span class="keyword">implements</span> <span class="title class_">AbstractFactory</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Shape <span class="title function_">createShape</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Rectangle</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Color <span class="title function_">createColor</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Blue</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="工厂方法模式与抽象工厂对比"><a href="#工厂方法模式与抽象工厂对比" class="headerlink" title="工厂方法模式与抽象工厂对比"></a>工厂方法模式与抽象工厂对比</h2><h3 id="工厂方法模式-1"><a href="#工厂方法模式-1" class="headerlink" title="工厂方法模式"></a>工厂方法模式</h3><p><strong>扩展产品类型</strong>：新增一种产品（如 <code>Triangle</code>），只需添加 <code>Triangle</code> 类和 <code>TriangleFactory</code> 类，<strong>无需修改现有代码</strong>，<strong>符合开闭原则</strong>。</p>
<h3 id="抽象工厂模式-1"><a href="#抽象工厂模式-1" class="headerlink" title="抽象工厂模式"></a>抽象工厂模式</h3><p><strong>扩展产品族</strong>：新增一个产品族（如“暗黑主题”），只需添加 <code>DarkThemeFactory</code> 并实现所有产品接口（<code>DarkButton</code>、<code>DarkTextBox</code>），<strong>无需修改现有代码</strong>，<strong>符合开闭原则</strong>。</p>
<p><strong>扩展产品种类</strong>：若需新增一种产品类型（如在UI组件中新增 <code>Checkbox</code>），必须修改所有工厂接口（<code>AbstractFactory</code>）和所有具体工厂类，<strong>违反开闭原则</strong>。<strong>这是抽象工厂的主要局限性</strong>。</p>
<table>
<thead>
<tr>
<th align="left"></th>
<th align="left"><strong>工厂方法模式</strong></th>
<th align="left"><strong>抽象工厂模式</strong></th>
</tr>
</thead>
<tbody><tr>
<td align="left"><strong>核心思想</strong></td>
<td align="left">通过子类化实现单一产品的多态创建</td>
<td align="left">通过组合多个工厂方法创建一组相关产品</td>
</tr>
<tr>
<td align="left"><strong>设计侧重点</strong></td>
<td align="left">单一产品的扩展性</td>
<td align="left">产品族的兼容性和一致性</td>
</tr>
<tr>
<td align="left"><strong>代码复杂度</strong></td>
<td align="left">较低（仅需管理单一产品类型）</td>
<td align="left">较高（需管理多个产品类型及其关系）</td>
</tr>
<tr>
<td align="left"><strong>适用性</strong></td>
<td align="left">单一产品的多态场景</td>
<td align="left">复杂系统中需要统一管理多个关联对象的场景</td>
</tr>
</tbody></table>
<p>当系统需要 <strong>独立扩展单一类型产品的不同变体</strong>，且产品之间无强关联时（例如不同数据库驱动、不同日志输出方式）。当系统需要 <strong>确保一组相关对象必须一起使用</strong>，且需要统一管理它们的生命周期时（例如跨平台UI组件、游戏主题资源）。</p>
<h1 id="单例模式"><a href="#单例模式" class="headerlink" title="单例模式"></a>单例模式</h1><p>在软件开发中，某些类需要<strong>全局唯一实例</strong>以确保行为一致或节省资源。例如：</p>
<ul>
<li><strong>配置管理类</strong>：多个实例可能导致配置冲突。</li>
<li><strong>数据库连接池</strong>：频繁创建连接对象会浪费资源。</li>
<li><strong>日志记录器</strong>：全局共享同一个日志文件句柄。</li>
</ul>
<p>直接通过 <code>new</code> 创建多个实例会导致资源浪费或状态不一致。单例模式通过<strong>强制控制实例化次数</strong>解决这一问题。</p>
<p>单例模式（Singleton Pattern）是一种<strong>创建型设计模式</strong>，核心思想是确保一个类<strong>只有一个实例</strong>，并提供一个<strong>全局访问点</strong>。<br>关键实现：</p>
<ol>
<li><strong>私有化构造函数</strong>：禁止外部直接通过 <code>new</code> 创建实例。</li>
<li><strong>静态私有实例</strong>：类内部持有唯一实例。</li>
<li><strong>静态公有方法</strong>：提供全局访问入口（如 <code>getInstance()</code>）。</li>
</ol>
<h2 id="饿汉式单例"><a href="#饿汉式单例" class="headerlink" title="饿汉式单例"></a>饿汉式单例</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EagerSingleton</span> &#123;</span><br><span class="line">    <span class="comment">// 类加载时直接初始化</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">EagerSingleton</span> <span class="variable">instance</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">EagerSingleton</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">EagerSingleton</span><span class="params">()</span> &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> EagerSingleton <span class="title function_">getInstance</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> instance;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>饿汉式在类加载时直接初始化实例，线程安全但可能浪费资源</p>
<h2 id="懒汉式单例"><a href="#懒汉式单例" class="headerlink" title="懒汉式单例"></a>懒汉式单例</h2><h3 id="双重锁检查"><a href="#双重锁检查" class="headerlink" title="双重锁检查"></a>双重锁检查</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Singleton</span> &#123;</span><br><span class="line">    <span class="comment">// 1. 私有静态实例（volatile 保证可见性和禁止指令重排序）</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">volatile</span> Singleton instance;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2. 私有构造函数，防止外部实例化</span></span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">Singleton</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// 防止通过反射破坏单例</span></span><br><span class="line">        <span class="keyword">if</span> (instance != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;禁止通过反射创建实例！&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 3. 全局访问方法（双重检查锁定）</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Singleton <span class="title function_">getInstance</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (instance == <span class="literal">null</span>) &#123; <span class="comment">// 第一次检查（避免不必要的同步）</span></span><br><span class="line">            <span class="keyword">synchronized</span> (Singleton.class) &#123;</span><br><span class="line">                <span class="keyword">if</span> (instance == <span class="literal">null</span>) &#123; <span class="comment">// 第二次检查（确保线程安全）</span></span><br><span class="line">                    instance = <span class="keyword">new</span> <span class="title class_">Singleton</span>();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> instance;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 示例方法</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">showMessage</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;单例对象调用成功！&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 客户端调用</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Client</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Singleton</span> <span class="variable">s1</span> <span class="operator">=</span> Singleton.getInstance();</span><br><span class="line">        <span class="type">Singleton</span> <span class="variable">s2</span> <span class="operator">=</span> Singleton.getInstance();</span><br><span class="line"></span><br><span class="line">        System.out.println(s1 == s2); <span class="comment">// 输出：true（同一对象）</span></span><br><span class="line">        s1.showMessage(); <span class="comment">// 输出：单例对象调用成功！</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="登记式-静态内部类"><a href="#登记式-静态内部类" class="headerlink" title="登记式&#x2F;静态内部类"></a>登记式&#x2F;静态内部类</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Singleton</span> &#123;</span><br><span class="line">    <span class="comment">// 1. 私有构造函数</span></span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">Singleton</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// 防止反射破坏单例</span></span><br><span class="line">        <span class="keyword">if</span> (InnerHolder.INSTANCE != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;禁止通过反射创建实例！&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2. 静态内部类（延迟加载的核心）</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">InnerHolder</span> &#123;</span><br><span class="line">        <span class="comment">// 静态初始化器由 JVM 保证线程安全</span></span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Singleton</span> <span class="variable">INSTANCE</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Singleton</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 3. 全局访问方法</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Singleton <span class="title function_">getInstance</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> InnerHolder.INSTANCE;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 示例方法</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">showMessage</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;静态内部类单例调用成功！&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这种方式能达到双检锁方式一样的功效，但实现更简单。对静态域使用延迟初始化，应使用这种方式而不是双检锁方式。这种方式只适用于静态域的情况，双检锁方式可在实例域需要延迟初始化时使用。这种方式同样利用了 classloader 机制来保证初始化 instance 时只有一个线程，它跟饿汉式不同的是：饿汉式只要 Singleton 类被装载了，那么 instance 就会被实例化（没有达到 lazy loading 效果），而这种方式是 Singleton 类被装载了，instance 不一定被初始化。因为 SingletonHolder 类没有被主动使用，只有通过显式调用 getInstance 方法时，才会显式装载 SingletonHolder 类，从而实例化 instance。</p>
<p>静态内部类单例模式通过 <strong>JVM 类加载机制</strong> 和 <strong>静态内部类的延迟加载特性</strong>，完美平衡了线程安全、延迟加载和代码简洁性。它是 Java 中实现单例模式的 <strong>推荐方式</strong>，尤其适合高并发场景。</p>
<p><strong>注意事项</strong></p>
<ol>
<li><p><strong>反射攻击</strong>：通过反射可绕过私有构造函数，需在构造器中添加防御代码。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="title function_">Singleton</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (InnerHolder.INSTANCE != <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;禁止通过反射创建实例！&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>序列化破坏</strong>：反序列化会创建新对象，需实现 <code>readResolve()</code> 方法返回实例。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> Object <span class="title function_">readResolve</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> InnerHolder.INSTANCE; <span class="comment">// 直接返回单例实例，避免反序列化创建新对象</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>多类加载器</strong>：不同类加载器可能导致多个实例，需确保类加载器唯一。</p>
</li>
</ol>
<h2 id="三种实现方式对比"><a href="#三种实现方式对比" class="headerlink" title="三种实现方式对比"></a>三种实现方式对比</h2><table>
<thead>
<tr>
<th align="left"><strong>实现方式</strong></th>
<th align="left"><strong>懒加载</strong></th>
<th align="left"><strong>线程安全</strong></th>
<th align="left"><strong>代码复杂度</strong></th>
<th align="left"><strong>防反射&#x2F;序列化破坏</strong></th>
</tr>
</thead>
<tbody><tr>
<td align="left">双重检查锁定（DCL）</td>
<td align="left">✅</td>
<td align="left">✅</td>
<td align="left">高（需 volatile 和 synchronized）</td>
<td align="left">可以额外处理</td>
</tr>
<tr>
<td align="left">饿汉式</td>
<td align="left">❌</td>
<td align="left">✅</td>
<td align="left">低</td>
<td align="left">❌</td>
</tr>
<tr>
<td align="left">静态内部类</td>
<td align="left">✅</td>
<td align="left">✅</td>
<td align="left">低</td>
<td align="left">可以额外处理</td>
</tr>
</tbody></table>
<h2 id="作用-1"><a href="#作用-1" class="headerlink" title="作用"></a><strong>作用</strong></h2><ol>
<li><strong>资源优化</strong>：避免重复创建对象，节省内存和初始化开销。</li>
<li><strong>状态一致性</strong>：全局唯一实例保证数据和行为统一。</li>
<li><strong>访问控制</strong>：提供统一的入口，便于管理依赖关系。</li>
</ol>
<h2 id="使用场景-1"><a href="#使用场景-1" class="headerlink" title="使用场景"></a><strong>使用场景</strong></h2><ol>
<li><strong>共享资源管理</strong>：如线程池、缓存、文件系统。</li>
<li><strong>配置信息类</strong>：全局统一的配置参数。</li>
<li><strong>工具类</strong>：无状态的工具方法集合（如日期格式化）。</li>
<li><strong>全局计数器</strong>：需要统一统计的场景。</li>
</ol>
<h1 id="建造者模式"><a href="#建造者模式" class="headerlink" title="建造者模式"></a>建造者模式</h1><p>在软件开发中，当需要创建 <strong>复杂对象</strong>（包含多个组成部分或配置参数）时，直接通过构造函数或 <code>setter</code> 方法会导致以下问题：</p>
<ol>
<li><strong>构造函数参数爆炸</strong>：对象包含大量可选参数时，构造方法需要重载多个版本（如 <code>new Product(p1, p2, p3, ...)</code>），代码臃肿且难以维护。</li>
<li><strong>构造过程不灵活</strong>：对象的构造步骤可能需要按特定顺序执行，直接调用 <code>setter</code> 方法容易遗漏步骤或破坏一致性。</li>
<li><strong>对象表示与构造逻辑耦合</strong>：同一对象的构造逻辑可能因场景不同而变化（如不同配置的电脑组装）。</li>
</ol>
<p><strong>建造者模式</strong> 通过 <strong>分离对象的构造过程与表示</strong>，提供一种 <strong>分步骤、可复用</strong> 的创建方式，解决上述问题。</p>
<p>建造者模式（Builder Pattern）是一种 <strong>创建型设计模式</strong>，核心思想是将 <strong>复杂对象的构建过程拆解为多个独立步骤</strong>，并由一个 <strong>指导者（Director）</strong> 统一协调构造流程。</p>
<ul>
<li><strong>建造者（Builder）</strong>：定义构造步骤的抽象接口。</li>
<li><strong>具体建造者（ConcreteBuilder）</strong>：实现各步骤的具体逻辑，并返回最终对象。</li>
<li><strong>产品（Product）</strong>：被构造的复杂对象。</li>
<li><strong>指导者（Director）</strong>：按顺序调用建造者的方法，控制构造流程。</li>
</ul>
<h2 id="作用-2"><a href="#作用-2" class="headerlink" title="作用"></a><strong>作用</strong></h2><ol>
<li><strong>解耦构造过程与对象表示</strong>：同一构造过程可创建不同配置的对象。</li>
<li><strong>分步构造</strong>：支持按需设置参数，避免构造方法参数过多。</li>
<li><strong>代码可维护性</strong>：新增构造逻辑只需扩展新的建造者，无需修改已有代码。</li>
<li><strong>精细化控制</strong>：指导者可确保构造步骤的顺序和完整性。</li>
</ol>
<h2 id="使用场景-2"><a href="#使用场景-2" class="headerlink" title="使用场景"></a><strong>使用场景</strong></h2><ol>
<li><strong>对象包含多个可选参数或复杂依赖</strong>（如配置类、HTTP 请求）。</li>
<li><strong>需要不同配置的同一类对象</strong>（如不同套餐的订单、不同配置的电脑）。</li>
<li><strong>构造过程需要分步骤或严格顺序</strong>（如文档生成器、游戏角色创建）。</li>
<li><strong>希望隐藏对象的构造细节</strong>（如框架中复杂对象的创建）。</li>
</ol>
<h2 id="案例"><a href="#案例" class="headerlink" title="案例"></a>案例</h2><p>以搭建一台计算机为例子，计算机包含必选组件（CPU、内存）和可选组件（硬盘、显卡）。</p>
<p><strong>1. 定义产品类（Computer）</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 产品类</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Computer</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String cpu;     <span class="comment">// 必选</span></span><br><span class="line">    <span class="keyword">private</span> String ram;     <span class="comment">// 必选</span></span><br><span class="line">    <span class="keyword">private</span> String hdd;     <span class="comment">// 可选</span></span><br><span class="line">    <span class="keyword">private</span> String gpu;     <span class="comment">// 可选</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Computer</span><span class="params">(String cpu, String ram)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.cpu = cpu;</span><br><span class="line">        <span class="built_in">this</span>.ram = ram;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 可选组件的 setter 方法</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setHdd</span><span class="params">(String hdd)</span> &#123; <span class="built_in">this</span>.hdd = hdd; &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setGpu</span><span class="params">(String gpu)</span> &#123; <span class="built_in">this</span>.gpu = gpu; &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Computer [CPU=&quot;</span> + cpu + <span class="string">&quot;, RAM=&quot;</span> + ram + <span class="string">&quot;, HDD=&quot;</span> + hdd + <span class="string">&quot;, GPU=&quot;</span> + gpu + <span class="string">&quot;]&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>2. 定义抽象建造者（ComputerBuilder）</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 抽象建造者接口</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">ComputerBuilder</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">setCPU</span><span class="params">(String cpu)</span>;      <span class="comment">// 必选步骤</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">setRAM</span><span class="params">(String ram)</span>;      <span class="comment">// 必选步骤</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">setHDD</span><span class="params">(String hdd)</span>;      <span class="comment">// 可选步骤</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">setGPU</span><span class="params">(String gpu)</span>;      <span class="comment">// 可选步骤</span></span><br><span class="line">    Computer <span class="title function_">build</span><span class="params">()</span>;             <span class="comment">// 返回最终产品</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>3. 实现具体建造者（GamingComputerBuilder）</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 具体建造者：游戏电脑配置</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">GamingComputerBuilder</span> <span class="keyword">implements</span> <span class="title class_">ComputerBuilder</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Computer computer;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">GamingComputerBuilder</span><span class="params">(String baseCpu, String baseRam)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.computer = <span class="keyword">new</span> <span class="title class_">Computer</span>(baseCpu, baseRam);  <span class="comment">// 初始化必选组件</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setCPU</span><span class="params">(String cpu)</span> &#123;</span><br><span class="line">        computer.setCpu(cpu);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setRAM</span><span class="params">(String ram)</span> &#123;</span><br><span class="line">        computer.setRam(ram);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setHDD</span><span class="params">(String hdd)</span> &#123;</span><br><span class="line">        computer.setHdd(hdd);  <span class="comment">// 可选：设置硬盘</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setGPU</span><span class="params">(String gpu)</span> &#123;</span><br><span class="line">        computer.setGpu(gpu);  <span class="comment">// 可选：设置显卡</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Computer <span class="title function_">build</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> computer;  <span class="comment">// 返回构建完成的计算机</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>4. 定义指导者（Director，可选）</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 指导者（统一构造流程）</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Director</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> Computer <span class="title function_">buildGamingComputer</span><span class="params">(ComputerBuilder builder)</span> &#123;</span><br><span class="line">        builder.setCPU(<span class="string">&quot;Intel i9&quot;</span>);    <span class="comment">// 必选</span></span><br><span class="line">        builder.setRAM(<span class="string">&quot;32GB DDR5&quot;</span>);  <span class="comment">// 必选</span></span><br><span class="line">        builder.setHDD(<span class="string">&quot;1TB SSD&quot;</span>);     <span class="comment">// 可选</span></span><br><span class="line">        builder.setGPU(<span class="string">&quot;NVIDIA RTX 4090&quot;</span>); <span class="comment">// 可选</span></span><br><span class="line">        <span class="keyword">return</span> builder.build();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>5. 客户端调用</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Client</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">// 方式1：直接使用建造者（无需指导者）</span></span><br><span class="line">        <span class="type">ComputerBuilder</span> <span class="variable">builder</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">GamingComputerBuilder</span>(<span class="string">&quot;Intel i7&quot;</span>, <span class="string">&quot;16GB DDR4&quot;</span>);</span><br><span class="line">        builder.setHDD(<span class="string">&quot;512GB SSD&quot;</span>);</span><br><span class="line">        builder.setGPU(<span class="string">&quot;NVIDIA RTX 3080&quot;</span>);</span><br><span class="line">        <span class="type">Computer</span> <span class="variable">computer1</span> <span class="operator">=</span> builder.build();</span><br><span class="line">        System.out.println(<span class="string">&quot;自定义配置: &quot;</span> + computer1);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 方式2：通过指导者构建</span></span><br><span class="line">        <span class="type">Director</span> <span class="variable">director</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Director</span>();</span><br><span class="line">        <span class="type">Computer</span> <span class="variable">computer2</span> <span class="operator">=</span> director.buildGamingComputer(<span class="keyword">new</span> <span class="title class_">GamingComputerBuilder</span>(<span class="string">&quot;&quot;</span>, <span class="string">&quot;&quot;</span>));</span><br><span class="line">        System.out.println(<span class="string">&quot;推荐配置: &quot;</span> + computer2);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>建造者模式通过分步骤构造复杂对象</strong>，解决了多参数、可选配置和构造顺序的难题。其核心优势在于：</p>
<ol>
<li><strong>灵活性</strong>：支持不同配置的对象构造。</li>
<li><strong>可维护性</strong>：构造逻辑集中管理，易于扩展。</li>
<li><strong>高可读性</strong>：链式调用使代码更直观。</li>
</ol>
<p>经典应用场景包括：</p>
<ul>
<li>Java 中的 <code>StringBuilder</code>、<code>DocumentBuilder</code>。</li>
<li>Android 中的 <code>AlertDialog.Builder</code>。</li>
<li>Spring 中的 <code>BeanDefinitionBuilder</code>。</li>
</ul>
<h2 id="与传统构造方式对比"><a href="#与传统构造方式对比" class="headerlink" title="与传统构造方式对比"></a>与传统构造方式对比</h2><table>
<thead>
<tr>
<th align="left"><strong>构造方式</strong></th>
<th align="left"><strong>传统构造方法</strong></th>
<th align="left"><strong>建造者模式</strong></th>
</tr>
</thead>
<tbody><tr>
<td align="left"><strong>多参数处理</strong></td>
<td align="left">需重载多个构造函数，代码臃肿</td>
<td align="left">通过方法链式调用，灵活设置参数</td>
</tr>
<tr>
<td align="left"><strong>可选参数</strong></td>
<td align="left">需为每个参数组合提供构造方法</td>
<td align="left">按需调用 <code>setter</code>，避免冗余代码</td>
</tr>
<tr>
<td align="left"><strong>构造顺序控制</strong></td>
<td align="left">无法保证步骤顺序，易遗漏必选参数</td>
<td align="left">指导者可强制必选步骤的执行顺序</td>
</tr>
<tr>
<td align="left"><strong>代码可读性</strong></td>
<td align="left">参数含义不直观（如 <code>new Computer(&quot;i7&quot;, 16, null, &quot;3080&quot;)</code>）</td>
<td align="left">链式调用清晰（如 <code>.setCPU(&quot;i7&quot;).setRAM(16)...</code>）</td>
</tr>
</tbody></table>
<h1 id="原型模式"><a href="#原型模式" class="headerlink" title="原型模式"></a>原型模式</h1><p>在软件开发中，直接通过 <code>new</code> 创建对象可能导致以下问题：</p>
<ol>
<li><strong>资源消耗大</strong>：对象初始化需要复杂计算、数据库查询或网络请求，重复创建效率低下。</li>
<li><strong>依赖具体类</strong>：客户端代码需硬编码类名，违反依赖倒置原则。</li>
<li><strong>动态配置困难</strong>：对象需根据已有实例的状态动态调整参数，直接构造难以复用已有状态。</li>
</ol>
<p><strong>原型模式</strong> 通过 <strong>克隆已有对象</strong> 生成新对象，避免重复初始化过程，提升性能和灵活性。</p>
<p>原型模式（Prototype Pattern）是一种 <strong>创建型设计模式</strong>，核心思想是通过 <strong>复制现有实例</strong>（原型）创建新对象，而非通过 <code>new</code> 实例化类。</p>
<ul>
<li><strong>原型接口</strong>：声明克隆方法（如 <code>clone()</code>）。</li>
<li><strong>具体原型</strong>：实现克隆逻辑，生成自身副本。</li>
<li><strong>客户端</strong>：通过原型对象克隆新实例，无需依赖具体类。</li>
</ul>
<h2 id="作用-3"><a href="#作用-3" class="headerlink" title="作用"></a><strong>作用</strong></h2><ol>
<li><strong>性能优化</strong>：绕过复杂初始化过程，直接复制已有对象状态。</li>
<li><strong>动态创建对象</strong>：运行时根据原型动态生成新对象。</li>
<li><strong>解耦客户端与具体类</strong>：客户端仅依赖原型接口，与具体实现解耦。</li>
<li><strong>快速生成相似对象</strong>：适用于对象状态变化频繁的场景。</li>
</ol>
<h2 id="使用场景-3"><a href="#使用场景-3" class="headerlink" title="使用场景"></a><strong>使用场景</strong></h2><ol>
<li><strong>对象创建成本高</strong>：如数据库连接、复杂计算结果的缓存复用。</li>
<li><strong>需要隔离对象创建细节</strong>：如游戏开发中快速生成敌人、武器等实体。</li>
<li><strong>动态配置对象</strong>：通过修改原型状态生成不同配置的实例。</li>
<li><strong>撤销&#x2F;恢复功能</strong>：保存对象历史状态（如文档编辑器的快照）。</li>
</ol>
<h2 id="经典简单实例"><a href="#经典简单实例" class="headerlink" title="经典简单实例"></a><strong>经典简单实例</strong></h2><p>以图形编辑器中的形状克隆为例，演示原型模式的实现。</p>
<p><strong>1. 定义原型接口（实现 Cloneable）</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 原型接口（Java 中 Cloneable 是标记接口）</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">Shape</span> <span class="keyword">implements</span> <span class="title class_">Cloneable</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String type;</span><br><span class="line">    <span class="keyword">private</span> String color;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Shape</span><span class="params">(String type, String color)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.type = type;</span><br><span class="line">        <span class="built_in">this</span>.color = color;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 抽象方法（由子类实现具体绘制逻辑）</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title function_">draw</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 重写 clone() 方法实现浅拷贝</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Shape <span class="title function_">clone</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> (Shape) <span class="built_in">super</span>.clone();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (CloneNotSupportedException e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;克隆失败&quot;</span>, e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Getter &amp; Setter</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getType</span><span class="params">()</span> &#123; <span class="keyword">return</span> type; &#125;</span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getColor</span><span class="params">()</span> &#123; <span class="keyword">return</span> color; &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setColor</span><span class="params">(String color)</span> &#123; <span class="built_in">this</span>.color = color; &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>2. 实现具体原型类</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 具体原型1：圆形</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Circle</span> <span class="keyword">extends</span> <span class="title class_">Shape</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Circle</span><span class="params">(String color)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(<span class="string">&quot;Circle&quot;</span>, color);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">draw</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;绘制 &quot;</span> + getColor() + <span class="string">&quot; 的圆形&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体原型2：矩形</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Rectangle</span> <span class="keyword">extends</span> <span class="title class_">Shape</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Rectangle</span><span class="params">(String color)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(<span class="string">&quot;Rectangle&quot;</span>, color);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">draw</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;绘制 &quot;</span> + getColor() + <span class="string">&quot; 的矩形&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>3. 客户端调用</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Client</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">// 初始化原型对象</span></span><br><span class="line">        <span class="type">Shape</span> <span class="variable">redCircle</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Circle</span>(<span class="string">&quot;红色&quot;</span>);</span><br><span class="line">        <span class="type">Shape</span> <span class="variable">blueRectangle</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Rectangle</span>(<span class="string">&quot;蓝色&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 通过克隆生成新对象</span></span><br><span class="line">        <span class="type">Shape</span> <span class="variable">clonedCircle</span> <span class="operator">=</span> redCircle.clone();</span><br><span class="line">        clonedCircle.setColor(<span class="string">&quot;绿色&quot;</span>); <span class="comment">// 修改克隆体的颜色</span></span><br><span class="line">        </span><br><span class="line">        <span class="type">Shape</span> <span class="variable">clonedRectangle</span> <span class="operator">=</span> blueRectangle.clone();</span><br><span class="line">        clonedRectangle.setColor(<span class="string">&quot;黄色&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 验证克隆结果</span></span><br><span class="line">        System.out.println(<span class="string">&quot;原始圆形颜色: &quot;</span> + redCircle.getColor()); <span class="comment">// 输出: 红色</span></span><br><span class="line">        System.out.println(<span class="string">&quot;克隆圆形颜色: &quot;</span> + clonedCircle.getColor()); <span class="comment">// 输出: 绿色</span></span><br><span class="line">        </span><br><span class="line">        clonedCircle.draw(); <span class="comment">// 输出: 绘制 绿色 的圆形</span></span><br><span class="line">        clonedRectangle.draw(); <span class="comment">// 输出: 绘制 黄色 的矩形</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="深拷贝与浅拷贝"><a href="#深拷贝与浅拷贝" class="headerlink" title="深拷贝与浅拷贝"></a><strong>深拷贝与浅拷贝</strong></h2><ul>
<li><strong>浅拷贝</strong>：复制对象基本类型字段和引用地址，引用类型成员与原对象共享。</li>
<li><strong>深拷贝</strong>：完全复制对象及其引用链上的所有对象，需手动处理引用类型字段。</li>
</ul>
<p><strong>示例（深拷贝实现）</strong>：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ComplexShape</span> <span class="keyword">extends</span> <span class="title class_">Shape</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> List&lt;String&gt; tags;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">ComplexShape</span><span class="params">(String type, String color, List&lt;String&gt; tags)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(type, color);</span><br><span class="line">        <span class="built_in">this</span>.tags = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;(tags); <span class="comment">// 避免外部修改</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> ComplexShape <span class="title function_">clone</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">ComplexShape</span> <span class="variable">clone</span> <span class="operator">=</span> (ComplexShape) <span class="built_in">super</span>.clone();</span><br><span class="line">        clone.tags = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;(<span class="built_in">this</span>.tags); <span class="comment">// 深拷贝列表</span></span><br><span class="line">        <span class="keyword">return</span> clone;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="对比其他创建型模式"><a href="#对比其他创建型模式" class="headerlink" title="对比其他创建型模式"></a><strong>对比其他创建型模式</strong></h2><table>
<thead>
<tr>
<th align="left"><strong>模式</strong></th>
<th align="left"><strong>核心思想</strong></th>
<th align="left"><strong>适用场景</strong></th>
</tr>
</thead>
<tbody><tr>
<td align="left"><strong>工厂方法</strong></td>
<td align="left">子类决定实例化哪个类</td>
<td align="left">需要解耦对象创建与使用</td>
</tr>
<tr>
<td align="left"><strong>抽象工厂</strong></td>
<td align="left">创建多个相关产品族</td>
<td align="left">需要统一风格的多产品组合</td>
</tr>
<tr>
<td align="left"><strong>建造者</strong></td>
<td align="left">分步骤构造复杂对象</td>
<td align="left">对象参数多且构造顺序严格</td>
</tr>
<tr>
<td align="left"><strong>原型模式</strong></td>
<td align="left">克隆已有对象生成新实例</td>
<td align="left">对象创建成本高或需动态复制状态</td>
</tr>
</tbody></table>
<p><strong>原型模式通过克隆机制高效生成对象</strong>，尤其适用于以下场景：</p>
<ul>
<li><strong>性能敏感</strong>：避免重复执行高成本初始化逻辑。</li>
<li><strong>动态配置</strong>：通过修改原型状态快速生成变体对象。</li>
<li><strong>隔离创建细节</strong>：客户端无需依赖具体类名。</li>
</ul>
<p><strong>经典应用</strong>：</p>
<ul>
<li>Java 的 <code>Object.clone()</code> 方法。</li>
<li>Spring 的 Prototype Bean 作用域。</li>
<li>游戏开发中的敌人&#x2F;道具生成。</li>
</ul>
<h1 id="适配器模式"><a href="#适配器模式" class="headerlink" title="适配器模式"></a>适配器模式</h1><p>在软件开发中，常会遇到 <strong>接口不兼容</strong> 的问题。例如：</p>
<ul>
<li><strong>旧系统升级</strong>：旧代码需要调用新接口，但接口规范不匹配。</li>
<li><strong>整合第三方库</strong>：多个库功能相似但接口不同，难以统一调用。</li>
<li><strong>复用遗留代码</strong>：已有类功能可用，但接口不符合当前系统需求。</li>
</ul>
<p>直接修改原有接口可能导致代码侵入性高、风险大。适配器模式通过 <strong>包装转换接口</strong>，在不修改原有代码的基础上实现兼容。 </p>
<p>适配器模式（Adapter Pattern）是一种 <strong>结构型设计模式</strong>，核心思想是 <strong>将一个类的接口转换成客户端期望的另一个接口</strong>，使原本因接口不兼容而无法协同工作的类能够一起工作。</p>
<ul>
<li><strong>目标接口（Target）</strong>：客户端期望的接口。</li>
<li><strong>适配者类（Adaptee）</strong>：需要被适配的现有类。</li>
<li><strong>适配器类（Adapter）</strong>：实现目标接口，并包装适配者类的功能。</li>
</ul>
<p>适配器模式分为两种实现方式：</p>
<ol>
<li><strong>类适配器</strong>：通过继承适配者类实现（需支持多重继承，Java 中不适用）。</li>
<li><strong>对象适配器</strong>：通过组合适配者类对象实现（推荐方式）。</li>
</ol>
<h2 id="作用-4"><a href="#作用-4" class="headerlink" title="作用"></a><strong>作用</strong></h2><ol>
<li><strong>接口兼容</strong>：解决新旧系统或不同组件之间的接口不匹配问题。</li>
<li><strong>代码复用</strong>：无需修改现有代码即可复用已有功能。</li>
<li><strong>解耦</strong>：客户端仅依赖目标接口，与具体实现解耦。</li>
<li><strong>灵活性</strong>：可同时适配多个类或接口。</li>
</ol>
<hr>
<h2 id="使用场景-4"><a href="#使用场景-4" class="headerlink" title="使用场景"></a><strong>使用场景</strong></h2><ol>
<li><strong>旧系统整合</strong>：在新系统中复用遗留代码。</li>
<li><strong>统一接口规范</strong>：封装多个第三方服务（如支付网关、日志组件）。</li>
<li><strong>接口版本过渡</strong>：逐步替换旧接口，保持系统兼容性。</li>
<li><strong>工具类适配</strong>：将不同工具类的功能转换为统一接口。</li>
</ol>
<h2 id="经典简单实例-1"><a href="#经典简单实例-1" class="headerlink" title="经典简单实例"></a><strong>经典简单实例</strong></h2><p><strong>1. 定义目标接口（客户端期望的电压）</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 目标接口：客户端需要的5V电压</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">FiveVolt</span> &#123;</span><br><span class="line">    <span class="type">int</span> <span class="title function_">getVolt5</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>2. 定义适配者类（现有的欧洲220V插座）</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 适配者类：欧洲220V电源</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EuropeanSocket</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getVolt220</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">220</span>; <span class="comment">// 输出220V电压</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>3. 实现适配器类（对象适配器方式）</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 适配器类：将220V转换为5V</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">VoltageAdapter</span> <span class="keyword">implements</span> <span class="title class_">FiveVolt</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> EuropeanSocket socket; <span class="comment">// 组合适配者对象</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">VoltageAdapter</span><span class="params">(EuropeanSocket socket)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.socket = socket;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getVolt5</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">volt220</span> <span class="operator">=</span> socket.getVolt220();</span><br><span class="line">        <span class="keyword">return</span> convert(volt220); <span class="comment">// 电压转换逻辑</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> <span class="title function_">convert</span><span class="params">(<span class="type">int</span> volt220)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> volt220 / <span class="number">44</span>; <span class="comment">// 简化的转换逻辑（实际需电路设计）</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>4. 客户端调用</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Client</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">// 现有欧洲电源</span></span><br><span class="line">        <span class="type">EuropeanSocket</span> <span class="variable">europeanSocket</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">EuropeanSocket</span>();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 创建适配器，转换为5V</span></span><br><span class="line">        <span class="type">FiveVolt</span> <span class="variable">adapter</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">VoltageAdapter</span>(europeanSocket);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 客户端使用统一接口</span></span><br><span class="line">        System.out.println(<span class="string">&quot;输出电压: &quot;</span> + adapter.getVolt5() + <span class="string">&quot;V&quot;</span>); <span class="comment">// 输出: 5V</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="类适配器-vs-对象适配器"><a href="#类适配器-vs-对象适配器" class="headerlink" title="类适配器 vs 对象适配器"></a><strong>类适配器 vs 对象适配器</strong></h2><table>
<thead>
<tr>
<th align="left"><strong>特性</strong></th>
<th align="left"><strong>类适配器</strong></th>
<th align="left"><strong>对象适配器</strong></th>
</tr>
</thead>
<tbody><tr>
<td align="left"><strong>实现方式</strong></td>
<td align="left">继承适配者类（需多重继承支持）</td>
<td align="left">组合适配者类对象</td>
</tr>
<tr>
<td align="left"><strong>灵活性</strong></td>
<td align="left">只能适配一个特定类</td>
<td align="left">可适配多个类及其子类</td>
</tr>
<tr>
<td align="left"><strong>代码侵入性</strong></td>
<td align="left">需修改适配者类的继承关系</td>
<td align="left">无侵入，通过组合实现</td>
</tr>
<tr>
<td align="left"><strong>适用语言</strong></td>
<td align="left">支持多重继承的语言（如C++）</td>
<td align="left">所有面向对象语言（如Java、C#）</td>
</tr>
</tbody></table>
<h2 id="实际应用场景"><a href="#实际应用场景" class="headerlink" title="实际应用场景"></a><strong>实际应用场景</strong></h2><ol>
<li><p><strong>Java I&#x2F;O 流</strong>：<br><code>InputStreamReader</code> 和 <code>OutputStreamWriter</code> 是适配器，将字节流转换为字符流。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 字节流 -&gt; 字符流适配</span></span><br><span class="line"><span class="type">InputStream</span> <span class="variable">is</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileInputStream</span>(<span class="string">&quot;file.txt&quot;</span>);</span><br><span class="line"><span class="type">Reader</span> <span class="variable">reader</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">InputStreamReader</span>(is, <span class="string">&quot;UTF-8&quot;</span>);</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>集合框架</strong>：<br><code>Arrays.asList()</code> 将数组适配为 <code>List</code> 接口。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">String[] arr = &#123;<span class="string">&quot;A&quot;</span>, <span class="string">&quot;B&quot;</span>, <span class="string">&quot;C&quot;</span>&#125;;</span><br><span class="line">List&lt;String&gt; list = Arrays.asList(arr); <span class="comment">// 适配器模式</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>Spring MVC</strong>：<br><code>HandlerAdapter</code> 将不同类型的 Controller 适配为统一的处理接口。</p>
</li>
</ol>
<h1 id="桥接模式"><a href="#桥接模式" class="headerlink" title="桥接模式"></a>桥接模式</h1><p>在软件开发中，当系统存在 <strong>多个独立变化的维度</strong>（如形状和颜色、设备与操作系统），若使用传统的继承机制，会导致 <strong>类爆炸</strong>（如 <code>RedCircle</code>、<code>BlueSquare</code> 等组合类剧增），维护和扩展困难。例如：</p>
<ul>
<li><strong>图形系统</strong>：形状（圆形、方形）与渲染方式（矢量、光栅）的组合。</li>
<li><strong>跨平台应用</strong>：功能模块（文件操作、网络请求）与操作系统（Windows、Linux）的适配。</li>
</ul>
<p>桥接模式通过 <strong>将抽象与实现分离</strong>，允许两者独立变化，避免因组合维度增加导致的代码臃肿。</p>
<p><strong>桥接模式（Bridge Pattern）</strong> 是一种 <strong>结构型设计模式</strong>，核心思想是将 <strong>抽象部分（Abstraction）</strong> 与 <strong>实现部分（Implementation）</strong> 解耦，使它们可以独立扩展。</p>
<ul>
<li><strong>抽象部分</strong>：定义高层次的业务逻辑（如形状的绘制流程）。</li>
<li><strong>实现部分</strong>：定义底层具体实现（如渲染引擎的具体算法）。</li>
<li><strong>桥接</strong>：通过组合而非继承，将抽象与实现关联。</li>
</ul>
<h2 id="作用-5"><a href="#作用-5" class="headerlink" title="作用"></a><strong>作用</strong></h2><ol>
<li><strong>解耦抽象与实现</strong>：两者可独立扩展，互不影响。</li>
<li><strong>减少子类数量</strong>：避免为每个维度组合创建子类。</li>
<li><strong>提高灵活性</strong>：运行时动态切换实现（如切换渲染引擎）。</li>
<li><strong>增强可维护性</strong>：修改一个维度不影响其他维度。</li>
</ol>
<h2 id="使用场景-5"><a href="#使用场景-5" class="headerlink" title="使用场景"></a><strong>使用场景</strong></h2><ol>
<li><strong>多维度变化</strong>：系统存在多个独立变化的维度，需灵活组合。</li>
<li><strong>避免继承膨胀</strong>：不希望使用多层继承导致类数量爆炸。</li>
<li><strong>运行时绑定实现</strong>：需要在运行时动态切换底层实现。</li>
<li><strong>跨平台开发</strong>：同一功能需适配不同操作系统或硬件设备。</li>
</ol>
<h2 id="经典简单实例-2"><a href="#经典简单实例-2" class="headerlink" title="经典简单实例"></a><strong>经典简单实例</strong></h2><p>以 <strong>图形绘制系统</strong> 为例，实现形状（抽象）与渲染引擎（实现）的桥接。</p>
<p><strong>1. 定义实现部分接口（渲染引擎）</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 实现部分接口：渲染引擎</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Renderer</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">renderCircle</span><span class="params">(<span class="type">float</span> radius)</span>;  <span class="comment">// 渲染圆形</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">renderSquare</span><span class="params">(<span class="type">float</span> side)</span>;    <span class="comment">// 渲染方形</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>2. 实现具体渲染引擎</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 具体实现1：矢量渲染</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">VectorRenderer</span> <span class="keyword">implements</span> <span class="title class_">Renderer</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">renderCircle</span><span class="params">(<span class="type">float</span> radius)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;矢量渲染圆形，半径：&quot;</span> + radius);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">renderSquare</span><span class="params">(<span class="type">float</span> side)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;矢量渲染方形，边长：&quot;</span> + side);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体实现2：光栅渲染</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RasterRenderer</span> <span class="keyword">implements</span> <span class="title class_">Renderer</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">renderCircle</span><span class="params">(<span class="type">float</span> radius)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;光栅渲染圆形，半径：&quot;</span> + radius);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">renderSquare</span><span class="params">(<span class="type">float</span> side)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;光栅渲染方形，边长：&quot;</span> + side);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>3. 定义抽象部分（形状）</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 抽象部分基类：形状</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">Shape</span> &#123;</span><br><span class="line">    <span class="keyword">protected</span> Renderer renderer;  <span class="comment">// 桥接关键：持有实现部分的引用</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Shape</span><span class="params">(Renderer renderer)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.renderer = renderer;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title function_">draw</span><span class="params">()</span>;  <span class="comment">// 绘制方法</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>4. 实现具体形状</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 具体抽象1：圆形</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Circle</span> <span class="keyword">extends</span> <span class="title class_">Shape</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">float</span> radius;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Circle</span><span class="params">(Renderer renderer, <span class="type">float</span> radius)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(renderer);</span><br><span class="line">        <span class="built_in">this</span>.radius = radius;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">draw</span><span class="params">()</span> &#123;</span><br><span class="line">        renderer.renderCircle(radius);  <span class="comment">// 调用实现部分的渲染逻辑</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体抽象2：方形</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Square</span> <span class="keyword">extends</span> <span class="title class_">Shape</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">float</span> side;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Square</span><span class="params">(Renderer renderer, <span class="type">float</span> side)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(renderer);</span><br><span class="line">        <span class="built_in">this</span>.side = side;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">draw</span><span class="params">()</span> &#123;</span><br><span class="line">        renderer.renderSquare(side);  <span class="comment">// 调用实现部分的渲染逻辑</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>5. 客户端调用</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Client</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">// 创建渲染引擎</span></span><br><span class="line">        <span class="type">Renderer</span> <span class="variable">vectorRenderer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">VectorRenderer</span>();</span><br><span class="line">        <span class="type">Renderer</span> <span class="variable">rasterRenderer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RasterRenderer</span>();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 桥接形状与渲染引擎</span></span><br><span class="line">        <span class="type">Shape</span> <span class="variable">circle</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Circle</span>(vectorRenderer, <span class="number">5.0f</span>);</span><br><span class="line">        <span class="type">Shape</span> <span class="variable">square</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Square</span>(rasterRenderer, <span class="number">10.0f</span>);</span><br><span class="line"></span><br><span class="line">        circle.draw();  <span class="comment">// 输出：矢量渲染圆形，半径：5.0</span></span><br><span class="line">        square.draw();  <span class="comment">// 输出：光栅渲染方形，边长：10.0</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 动态切换渲染引擎</span></span><br><span class="line">        circle = <span class="keyword">new</span> <span class="title class_">Circle</span>(rasterRenderer, <span class="number">5.0f</span>);</span><br><span class="line">        circle.draw();  <span class="comment">// 输出：光栅渲染圆形，半径：5.0</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="实际应用场景-1"><a href="#实际应用场景-1" class="headerlink" title="实际应用场景"></a><strong>实际应用场景</strong></h2><ol>
<li><strong>GUI 框架</strong>：<ul>
<li>抽象：窗口、按钮、菜单。</li>
<li>实现：不同操作系统（Windows、macOS）的底层绘制。</li>
</ul>
</li>
<li><strong>数据库驱动</strong>：<ul>
<li>抽象：SQL 操作接口。</li>
<li>实现：MySQL、Oracle 等驱动的具体实现。</li>
</ul>
</li>
<li><strong>消息通知系统</strong>：<ul>
<li>抽象：消息类型（文本、图片）。</li>
<li>实现：发送渠道（邮件、短信、APP推送）。</li>
</ul>
</li>
</ol>
<p><strong>桥接模式通过组合代替继承，将抽象与实现解耦</strong>，适用于多维度变化的系统设计。其核心优势在于：</p>
<ol>
<li><strong>灵活性</strong>：运行时动态绑定实现。</li>
<li><strong>可扩展性</strong>：独立扩展抽象与实现部分。</li>
<li><strong>简洁性</strong>：避免类数量指数级增长。</li>
</ol>
<h1 id="组合模式"><a href="#组合模式" class="headerlink" title="组合模式"></a>组合模式</h1><p>组合模式（<strong>Composite Pattern</strong>）是一种<strong>结构型设计模式</strong>，通过将对象组织成树形结构，使客户端能够以统一的方式处理单个对象和对象组合。核心是<strong>抽象出一个公共接口</strong>，让叶子节点和组合节点具有一致的行为。</p>
<h2 id="作用-6"><a href="#作用-6" class="headerlink" title="作用"></a><strong>作用</strong></h2><ul>
<li><strong>统一操作</strong>：客户端无需区分处理的是单个对象还是组合对象。</li>
<li><strong>简化代码</strong>：消除复杂的条件判断，提升代码可维护性。</li>
<li><strong>扩展性强</strong>：新增组件类型时符合开闭原则（无需修改现有代码）。</li>
</ul>
<h2 id="使用场景-6"><a href="#使用场景-6" class="headerlink" title="使用场景"></a><strong>使用场景</strong></h2><ul>
<li>需要表示<strong>部分-整体层次结构</strong>的场景（如文件系统、菜单&#x2F;子菜单）。</li>
<li>希望<strong>递归处理</strong>整个结构（如计算总价格、统计文件大小）。</li>
<li>GUI开发中嵌套组件（如窗口包含面板，面板包含按钮）。</li>
<li>组织架构管理（如部门与员工的关系）。</li>
</ul>
<h2 id="经典简单实例-3"><a href="#经典简单实例-3" class="headerlink" title="经典简单实例"></a><strong>经典简单实例</strong></h2><p>文件系统：</p>
<p><strong>类结构设计</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1. 抽象组件接口（定义统一操作）</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">FileSystemComponent</span> &#123;</span><br><span class="line">    <span class="type">int</span> <span class="title function_">getSize</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. 叶子节点：文件</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">File</span> <span class="keyword">implements</span> <span class="title class_">FileSystemComponent</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> size;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">File</span><span class="params">(<span class="type">int</span> size)</span> &#123; <span class="built_in">this</span>.size = size; &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getSize</span><span class="params">()</span> &#123; <span class="keyword">return</span> size; &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3. 复合节点：文件夹（可包含子组件）</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Folder</span> <span class="keyword">implements</span> <span class="title class_">FileSystemComponent</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> List&lt;FileSystemComponent&gt; children = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">add</span><span class="params">(FileSystemComponent component)</span> &#123;</span><br><span class="line">        children.add(component);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getSize</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">total</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (FileSystemComponent child : children) &#123;</span><br><span class="line">            total += child.getSize(); <span class="comment">// 递归计算子组件大小</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> total;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>客户端调用</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">// 创建文件</span></span><br><span class="line">        <span class="type">File</span> <span class="variable">file1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(<span class="number">100</span>);</span><br><span class="line">        <span class="type">File</span> <span class="variable">file2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(<span class="number">200</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 创建文件夹并添加文件</span></span><br><span class="line">        <span class="type">Folder</span> <span class="variable">folder1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Folder</span>();</span><br><span class="line">        <span class="type">Folder</span> <span class="variable">folder2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Folder</span>();</span><br><span class="line">        folder1.add(file1);</span><br><span class="line">        folder2.add(file2);</span><br><span class="line">        folder2.add(folder1);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 统一调用getSize()</span></span><br><span class="line">        System.out.println(<span class="string">&quot;文件大小: &quot;</span> + file1.getSize());  <span class="comment">// 输出 100</span></span><br><span class="line">        System.out.println(<span class="string">&quot;文件夹大小: &quot;</span> + folder2.getSize()); <span class="comment">// 输出 300</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="装饰器模式"><a href="#装饰器模式" class="headerlink" title="装饰器模式"></a>装饰器模式</h1><p><strong>产生背景</strong></p>
<ul>
<li><strong>动态扩展需求</strong>：传统继承方式难以灵活地为对象添加功能（需预定义大量子类，导致“类爆炸”）。</li>
<li><strong>避免侵入性修改</strong>：不希望通过修改原有类结构来增强对象的行为（符合开闭原则）。</li>
<li><strong>运行时灵活性</strong>：需要在运行时动态地组合对象的功能（如Java IO流、GUI组件装饰）。</li>
</ul>
<p>装饰器模式（<strong>Decorator Pattern</strong>）是一种<strong>结构型设计模式</strong>，通过将对象<strong>包装在装饰器类中</strong>，<strong>动态地添加职责</strong>到对象上。<br>核心思想是：<strong>组合优于继承</strong>，提供比继承更灵活的扩展方式，同时保持接口一致性。</p>
<h2 id="作用-7"><a href="#作用-7" class="headerlink" title="作用"></a><strong>作用</strong></h2><ul>
<li><strong>动态增强功能</strong>：在不修改原有代码的情况下，为对象添加新职责。</li>
<li><strong>避免类爆炸</strong>：通过组合替代继承，减少子类数量。</li>
<li><strong>保持透明性</strong>：客户端无需感知对象是否被装饰，接口保持一致。</li>
<li><strong>职责自由组合</strong>：多个装饰器可以嵌套使用，实现功能叠加（如加密+压缩）。</li>
</ul>
<h2 id="使用场景-7"><a href="#使用场景-7" class="headerlink" title="使用场景"></a><strong>使用场景</strong></h2><ul>
<li><strong>动态扩展对象功能</strong>：如为文本添加颜色、字体等样式。</li>
<li><strong>不可用继承时</strong>：当类被标记为<code>final</code>或已有复杂的继承层次。</li>
<li><strong>多维度功能组合</strong>：如咖啡加糖、加奶、加冰等不同组合。</li>
<li><strong>核心功能与辅助功能解耦</strong>：如日志记录、权限校验等横切关注点。</li>
</ul>
<h2 id="经典简单实例-4"><a href="#经典简单实例-4" class="headerlink" title="经典简单实例"></a><strong>经典简单实例</strong></h2><p>咖啡订单系统</p>
<p><strong>类结构设计</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1. 抽象组件接口（定义核心功能）</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">Coffee</span> &#123;</span><br><span class="line">    String <span class="title function_">getDescription</span><span class="params">()</span>;</span><br><span class="line">    <span class="type">double</span> <span class="title function_">getCost</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. 具体组件：基础咖啡</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SimpleCoffee</span> <span class="keyword">implements</span> <span class="title class_">Coffee</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getDescription</span><span class="params">()</span> &#123; <span class="keyword">return</span> <span class="string">&quot;Simple Coffee&quot;</span>; &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">double</span> <span class="title function_">getCost</span><span class="params">()</span> &#123; <span class="keyword">return</span> <span class="number">2.0</span>; &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3. 装饰器抽象类（实现组件接口，持有组件对象）</span></span><br><span class="line"><span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">CoffeeDecorator</span> <span class="keyword">implements</span> <span class="title class_">Coffee</span> &#123;</span><br><span class="line">    <span class="keyword">protected</span> Coffee decoratedCoffee;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">CoffeeDecorator</span><span class="params">(Coffee coffee)</span> &#123; <span class="built_in">this</span>.decoratedCoffee = coffee; &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getDescription</span><span class="params">()</span> &#123; <span class="keyword">return</span> decoratedCoffee.getDescription(); &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">double</span> <span class="title function_">getCost</span><span class="params">()</span> &#123; <span class="keyword">return</span> decoratedCoffee.getCost(); &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 4. 具体装饰器：添加牛奶</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MilkDecorator</span> <span class="keyword">extends</span> <span class="title class_">CoffeeDecorator</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">MilkDecorator</span><span class="params">(Coffee coffee)</span> &#123; <span class="built_in">super</span>(coffee); &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getDescription</span><span class="params">()</span> &#123; <span class="keyword">return</span> <span class="built_in">super</span>.getDescription() + <span class="string">&quot;, Milk&quot;</span>; &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">double</span> <span class="title function_">getCost</span><span class="params">()</span> &#123; <span class="keyword">return</span> <span class="built_in">super</span>.getCost() + <span class="number">0.5</span>; &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 5. 具体装饰器：添加糖</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SugarDecorator</span> <span class="keyword">extends</span> <span class="title class_">CoffeeDecorator</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">SugarDecorator</span><span class="params">(Coffee coffee)</span> &#123; <span class="built_in">super</span>(coffee); &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getDescription</span><span class="params">()</span> &#123; <span class="keyword">return</span> <span class="built_in">super</span>.getDescription() + <span class="string">&quot;, Sugar&quot;</span>; &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">double</span> <span class="title function_">getCost</span><span class="params">()</span> &#123; <span class="keyword">return</span> <span class="built_in">super</span>.getCost() + <span class="number">0.2</span>; &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>客户端调用</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Client</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">// 基础咖啡</span></span><br><span class="line">        <span class="type">Coffee</span> <span class="variable">coffee</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SimpleCoffee</span>();</span><br><span class="line">        System.out.println(coffee.getDescription() + <span class="string">&quot; ￥&quot;</span> + coffee.getCost());</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 添加牛奶和糖</span></span><br><span class="line">        coffee = <span class="keyword">new</span> <span class="title class_">MilkDecorator</span>(coffee);</span><br><span class="line">        coffee = <span class="keyword">new</span> <span class="title class_">SugarDecorator</span>(coffee);</span><br><span class="line">        System.out.println(coffee.getDescription() + <span class="string">&quot; ￥&quot;</span> + coffee.getCost());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="代理模式"><a href="#代理模式" class="headerlink" title="代理模式"></a>代理模式</h1><p><strong>产生背景</strong></p>
<ul>
<li><strong>访问控制需求</strong>：需要限制或增强对某个对象的访问（如权限校验、延迟加载）。</li>
<li><strong>解耦与扩展</strong>：避免直接操作原始对象，通过中间层代理实现功能扩展或逻辑隔离。</li>
<li><strong>复杂操作封装</strong>：隐藏对象的创建细节或远程调用过程（如远程服务访问、数据库连接管理）。</li>
</ul>
<p>代理模式（<strong>Proxy Pattern</strong>）是一种<strong>结构型设计模式</strong>，通过<strong>创建代理对象</strong>来控制对原始对象（目标对象）的访问。<br>核心思想是：<strong>代理类与目标类实现同一接口</strong>，客户端通过代理间接操作目标对象，从而在访问前后插入额外逻辑。</p>
<h2 id="作用-8"><a href="#作用-8" class="headerlink" title="作用"></a><strong>作用</strong></h2><ul>
<li><strong>访问控制</strong>：限制客户端直接访问目标对象（如权限验证）。</li>
<li><strong>延迟加载</strong>：推迟高开销对象的创建（如图片加载、数据库连接）。</li>
<li><strong>功能增强</strong>：在不修改目标对象的情况下添加额外逻辑（如日志记录、性能监控）。</li>
<li><strong>简化复杂性</strong>：封装复杂操作（如远程调用、事务管理）。</li>
</ul>
<h2 id="使用场景-8"><a href="#使用场景-8" class="headerlink" title="使用场景"></a><strong>使用场景</strong></h2><ul>
<li><strong>远程代理</strong>：为远程服务提供本地代理（如RPC调用、Web Service）。</li>
<li><strong>虚拟代理</strong>：延迟资源密集型对象的初始化（如大图加载、文件下载）。</li>
<li><strong>保护代理</strong>：控制敏感对象的访问权限（如权限校验）。</li>
<li><strong>智能代理</strong>：添加隐式功能（如对象引用计数、缓存机制）。</li>
<li><strong>日志&#x2F;监控代理</strong>：记录操作日志或监控性能指标。</li>
</ul>
<h2 id="经典简单实例-5"><a href="#经典简单实例-5" class="headerlink" title="经典简单实例"></a><strong>经典简单实例</strong></h2><p>图片延迟加载</p>
<p><strong>类结构设计</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1. 抽象接口：定义图片加载行为</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">Image</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">display</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. 真实目标类：高开销的图片加载</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">RealImage</span> <span class="keyword">implements</span> <span class="title class_">Image</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String filename;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">RealImage</span><span class="params">(String filename)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.filename = filename;</span><br><span class="line">        loadFromDisk(); <span class="comment">// 模拟耗时操作</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">loadFromDisk</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Loading image: &quot;</span> + filename);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">display</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Displaying image: &quot;</span> + filename);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3. 代理类：控制图片的延迟加载</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ProxyImage</span> <span class="keyword">implements</span> <span class="title class_">Image</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String filename;</span><br><span class="line">    <span class="keyword">private</span> RealImage realImage; <span class="comment">// 延迟初始化真实对象</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">ProxyImage</span><span class="params">(String filename)</span> &#123; <span class="built_in">this</span>.filename = filename; &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">display</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (realImage == <span class="literal">null</span>) &#123;</span><br><span class="line">            realImage = <span class="keyword">new</span> <span class="title class_">RealImage</span>(filename); <span class="comment">// 首次访问时加载</span></span><br><span class="line">        &#125;</span><br><span class="line">        realImage.display();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>客户端调用</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Client</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">// 创建代理对象（此时不加载真实图片）</span></span><br><span class="line">        <span class="type">Image</span> <span class="variable">image</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ProxyImage</span>(<span class="string">&quot;test.jpg&quot;</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 第一次调用触发真实对象加载</span></span><br><span class="line">        image.display(); </span><br><span class="line">        <span class="comment">// 输出: Loading image: test.jpg</span></span><br><span class="line">        <span class="comment">//       Displaying image: test.jpg</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 第二次直接使用已加载对象</span></span><br><span class="line">        image.display(); </span><br><span class="line">        <span class="comment">// 输出: Displaying image: test.jpg</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>关键点</strong></p>
<ul>
<li><strong>接口一致性</strong>：代理与目标对象实现相同接口，客户端无感知。</li>
<li><strong>控制粒度</strong>：代理可决定何时创建真实对象或是否拦截请求。</li>
<li><strong>动态代理</strong>：通过反射机制动态生成代理（如Java的<code>InvocationHandler</code>、Spring AOP）。</li>
<li><strong>与装饰器模式区别</strong>：装饰器侧重增强功能，代理侧重控制访问。</li>
</ul>
<h2 id="动态代理"><a href="#动态代理" class="headerlink" title="动态代理"></a>动态代理</h2><h3 id="定义目标接口"><a href="#定义目标接口" class="headerlink" title="定义目标接口"></a><strong>定义目标接口</strong></h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 用户服务接口</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">login</span><span class="params">(String username)</span>;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">logout</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="实现目标类"><a href="#实现目标类" class="headerlink" title="实现目标类"></a><strong>实现目标类</strong></h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 真实对象</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">login</span><span class="params">(String username)</span> &#123;</span><br><span class="line">        System.out.println(username + <span class="string">&quot; 登录成功&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">logout</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;用户退出登录&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="实现InvocationHandler"><a href="#实现InvocationHandler" class="headerlink" title="实现InvocationHandler"></a><strong>实现InvocationHandler</strong></h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.lang.reflect.InvocationHandler;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 代理逻辑处理器</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LoggingHandler</span> <span class="keyword">implements</span> <span class="title class_">InvocationHandler</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Object target;  <span class="comment">// 被代理的真实对象</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">LoggingHandler</span><span class="params">(Object target)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.target = target;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">invoke</span><span class="params">(Object proxy, Method method, Object[] args)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">        <span class="comment">// 前置增强：记录方法调用日志</span></span><br><span class="line">        System.out.println(<span class="string">&quot;[Log] 调用方法: &quot;</span> + method.getName());</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 调用真实对象的方法</span></span><br><span class="line">        <span class="type">Object</span> <span class="variable">result</span> <span class="operator">=</span> method.invoke(target, args);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 后置增强（此处省略）</span></span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="生成动态代理对象"><a href="#生成动态代理对象" class="headerlink" title="生成动态代理对象"></a><strong>生成动态代理对象</strong></h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.lang.reflect.Proxy;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Client</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">// 1. 创建真实对象</span></span><br><span class="line">        <span class="type">UserService</span> <span class="variable">realService</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UserServiceImpl</span>();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2. 创建InvocationHandler，关联真实对象</span></span><br><span class="line">        <span class="type">InvocationHandler</span> <span class="variable">handler</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">LoggingHandler</span>(realService);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 3. 动态生成代理对象</span></span><br><span class="line">        <span class="type">UserService</span> <span class="variable">proxy</span> <span class="operator">=</span> (UserService) Proxy.newProxyInstance(</span><br><span class="line">            realService.getClass().getClassLoader(),  <span class="comment">// 类加载器</span></span><br><span class="line">            realService.getClass().getInterfaces(),   <span class="comment">// 实现的接口</span></span><br><span class="line">            handler                                   <span class="comment">// 调用处理器</span></span><br><span class="line">        );</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 4. 通过代理对象调用方法</span></span><br><span class="line">        proxy.login(<span class="string">&quot;admin&quot;</span>);</span><br><span class="line">        proxy.logout();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>动态代理的底层机制</strong></p>
<ul>
<li><strong>字节码生成</strong>：<code>Proxy.newProxyInstance()</code> 方法在运行时动态生成代理类的字节码。</li>
<li><strong>反射调用</strong>：通过 <code>Method.invoke()</code> 调用真实对象的方法。</li>
<li><strong>类加载器</strong>：使用目标类的类加载器加载生成的代理类。</li>
</ul>
<h2 id="动态代理-vs-静态代理"><a href="#动态代理-vs-静态代理" class="headerlink" title="动态代理 vs 静态代理"></a><strong>动态代理 vs 静态代理</strong></h2><table>
<thead>
<tr>
<th align="left"><strong>特性</strong></th>
<th align="left"><strong>静态代理</strong></th>
<th align="left"><strong>动态代理</strong></th>
</tr>
</thead>
<tbody><tr>
<td align="left"><strong>代理类创建</strong></td>
<td align="left">手动编写代理类</td>
<td align="left">运行时自动生成代理类</td>
</tr>
<tr>
<td align="left"><strong>代码冗余</strong></td>
<td align="left">每个接口需单独编写代理类（类爆炸）</td>
<td align="left">一个处理器可代理所有接口</td>
</tr>
<tr>
<td align="left"><strong>灵活性</strong></td>
<td align="left">修改逻辑需修改代理类源码</td>
<td align="left">通过修改 <code>InvocationHandler</code> 动态调整</td>
</tr>
<tr>
<td align="left"><strong>性能开销</strong></td>
<td align="left">无反射调用，性能高</td>
<td align="left">反射调用带来轻微性能损耗</td>
</tr>
<tr>
<td align="left"><strong>适用场景</strong></td>
<td align="left">代理少量固定接口</td>
<td align="left">代理多个接口或需统一处理的横切逻辑</td>
</tr>
</tbody></table>
<h1 id="外观模式"><a href="#外观模式" class="headerlink" title="外观模式"></a>外观模式</h1><p>外观模式（<strong>Facade Pattern</strong>）隐藏系统的复杂性，并向客户端提供了一个客户端可以访问系统的接口。这种类型的设计模式属于结构型模式，它向现有的系统添加一个接口，来隐藏系统的复杂性。</p>
<p>这种模式涉及到一个单一的类，该类提供了客户端请求的简化方法和对现有系统类方法的委托调用。核心思想是：<strong>封装交互细节</strong>，让客户端只需与外观对象交互，降低客户端与子系统的耦合度。</p>
<h2 id="作用-9"><a href="#作用-9" class="headerlink" title="作用"></a><strong>作用</strong></h2><ul>
<li><strong>简化接口</strong>：将多个子系统的复杂操作封装为简单的高层接口。</li>
<li><strong>降低耦合</strong>：客户端仅依赖外观类，避免直接调用子系统。</li>
<li><strong>提高安全性</strong>：限制客户端直接访问敏感子系统。</li>
<li><strong>增强灵活性</strong>：子系统的内部变化不影响客户端（外观类隔离变化）。</li>
</ul>
<h2 id="使用场景-9"><a href="#使用场景-9" class="headerlink" title="使用场景"></a><strong>使用场景</strong></h2><ul>
<li><strong>多层系统调用</strong>：需整合多个子系统完成一个功能（如电商下单涉及库存、支付、物流）。</li>
<li><strong>复杂子系统封装</strong>：隐藏技术细节，提供“一键式”操作（如操作系统启动、智能家居控制）。</li>
<li><strong>分层架构设计</strong>：为不同层次的模块提供统一入口（如API网关封装微服务调用）。</li>
<li><strong>遗留系统改造</strong>：通过外观类包装旧系统接口，提供现代化访问方式。</li>
</ul>
<h2 id="经典简单实例-6"><a href="#经典简单实例-6" class="headerlink" title="经典简单实例"></a><strong>经典简单实例</strong></h2><p>我们将创建一个 <strong>Shape</strong> 接口和实现了 <strong>Shape</strong> 接口的实体类。下一步是定义一个外观类 <strong>ShapeMaker</strong>。</p>
<p><strong>ShapeMaker</strong> 类使用实体类来代表用户对这些类的调用。客户端使用 <strong>ShapeMaker</strong> 类来显示结果。</p>
<p><strong>类结构设计</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 抽象接口</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Shape</span> &#123;</span><br><span class="line">   <span class="keyword">void</span> <span class="title function_">draw</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 实体类</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Rectangle</span> <span class="keyword">implements</span> <span class="title class_">Shape</span> &#123;</span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">draw</span><span class="params">()</span> &#123;</span><br><span class="line">      System.out.println(<span class="string">&quot;Rectangle::draw()&quot;</span>);</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 实体类</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Square</span> <span class="keyword">implements</span> <span class="title class_">Shape</span> &#123;</span><br><span class="line"> </span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">draw</span><span class="params">()</span> &#123;</span><br><span class="line">      System.out.println(<span class="string">&quot;Square::draw()&quot;</span>);</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 实体类</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Circle</span> <span class="keyword">implements</span> <span class="title class_">Shape</span> &#123;</span><br><span class="line"> </span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">draw</span><span class="params">()</span> &#123;</span><br><span class="line">      System.out.println(<span class="string">&quot;Circle::draw()&quot;</span>);</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 外观类</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ShapeMaker</span> &#123;</span><br><span class="line">   <span class="keyword">private</span> Shape circle;</span><br><span class="line">   <span class="keyword">private</span> Shape rectangle;</span><br><span class="line">   <span class="keyword">private</span> Shape square;</span><br><span class="line"> </span><br><span class="line">   <span class="keyword">public</span> <span class="title function_">ShapeMaker</span><span class="params">()</span> &#123;</span><br><span class="line">      circle = <span class="keyword">new</span> <span class="title class_">Circle</span>();</span><br><span class="line">      rectangle = <span class="keyword">new</span> <span class="title class_">Rectangle</span>();</span><br><span class="line">      square = <span class="keyword">new</span> <span class="title class_">Square</span>();</span><br><span class="line">   &#125;</span><br><span class="line"> </span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">drawCircle</span><span class="params">()</span>&#123;</span><br><span class="line">      circle.draw();</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">drawRectangle</span><span class="params">()</span>&#123;</span><br><span class="line">      rectangle.draw();</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">drawSquare</span><span class="params">()</span>&#123;</span><br><span class="line">      square.draw();</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>客户端调用</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Client</span> &#123;</span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">      <span class="type">ShapeMaker</span> <span class="variable">shapeMaker</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ShapeMaker</span>();</span><br><span class="line"> </span><br><span class="line">      shapeMaker.drawCircle();</span><br><span class="line">      shapeMaker.drawRectangle();</span><br><span class="line">      shapeMaker.drawSquare();      </span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>优缺点</strong></p>
<table>
<thead>
<tr>
<th align="left"><strong>优点</strong></th>
<th align="left"><strong>缺点</strong></th>
</tr>
</thead>
<tbody><tr>
<td align="left">简化客户端调用逻辑</td>
<td align="left">外观类可能成为“上帝类”</td>
</tr>
<tr>
<td align="left">提高子系统的独立性和可维护性</td>
<td align="left">新增功能需修改外观类</td>
</tr>
<tr>
<td align="left">符合迪米特法则（最少知识原则）</td>
<td align="left">无法阻止客户端直接访问子系统</td>
</tr>
</tbody></table>
<p>外观模式通过“化繁为简”的设计理念，将复杂系统的操作收敛到一个统一入口，是降低系统使用复杂度的经典解决方案。</p>
<h1 id="享元模式"><a href="#享元模式" class="headerlink" title="享元模式"></a>享元模式</h1><p><strong>产生背景</strong></p>
<ul>
<li><strong>资源消耗问题</strong>：系统中存在大量相似对象时（如文本编辑器中的字符、游戏中的粒子效果），重复创建会占用大量内存。</li>
<li><strong>重复对象冗余</strong>：许多对象的内部状态（固有属性）相同，只有少量外部状态（上下文信息）不同。</li>
<li><strong>性能优化需求</strong>：希望通过共享技术减少内存占用，提升系统性能（如数据库连接池、线程池）。</li>
</ul>
<p>享元模式（<strong>Flyweight Pattern</strong>）主要用于减少创建对象的数量，以减少内存占用和提高性能。这种类型的设计模式属于结构型模式，它提供了减少对象数量从而改善应用所需的对象结构的方式。核心思想是：<strong>分离内部状态（可共享）与外部状态（不可共享）</strong>，通过共享相同内部状态的对象，减少系统资源消耗。</p>
<h2 id="作用-10"><a href="#作用-10" class="headerlink" title="作用"></a><strong>作用</strong></h2><ul>
<li><strong>减少内存占用</strong>：复用已有对象，避免重复创建。</li>
<li><strong>提升性能</strong>：降低垃圾回收频率和对象初始化开销。</li>
<li><strong>简化对象管理</strong>：通过工厂类统一管理共享对象。</li>
<li><strong>支持大规模对象集合</strong>：适用于需要处理成千上万相似对象的场景。</li>
</ul>
<h2 id="使用场景-10"><a href="#使用场景-10" class="headerlink" title="使用场景"></a><strong>使用场景</strong></h2><ul>
<li><strong>大量相似对象存在</strong>：如文档中的字符、棋局中的棋子、游戏中的子弹。</li>
<li><strong>对象的大部分状态可外部化</strong>：仅有少量状态需要运行时传入。</li>
<li><strong>需要缓冲池的场景</strong>：如数据库连接池、线程池。</li>
<li><strong>不可变对象复用</strong>：如Java中的<code>String</code>常量池、<code>Integer</code>缓存池（-128~127）。</li>
</ul>
<h2 id="经典简单实例-7"><a href="#经典简单实例-7" class="headerlink" title="经典简单实例"></a><strong>经典简单实例</strong></h2><p><strong>文字编辑器字符对象</strong></p>
<p><strong>场景描述</strong></p>
<p>文字编辑器需要渲染大量字符（如字母、数字），每个字符的<strong>字体、颜色、大小</strong>等属性（内部状态）相同，但<strong>位置坐标</strong>（外部状态）不同。通过享元模式共享字符对象，避免为每个字符重复存储样式信息。</p>
<p><strong>类结构设计</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1. 享元接口：定义操作外部状态的方法</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">Character</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">display</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y)</span>; <span class="comment">// 外部状态：位置坐标</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. 具体享元类：存储内部状态</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ConcreteCharacter</span> <span class="keyword">implements</span> <span class="title class_">Character</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String charValue; <span class="comment">// 内部状态（不可变）</span></span><br><span class="line">    <span class="keyword">private</span> String font;       <span class="comment">// 内部状态</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> size;          <span class="comment">// 内部状态</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">ConcreteCharacter</span><span class="params">(String charValue, String font, <span class="type">int</span> size)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.charValue = charValue;</span><br><span class="line">        <span class="built_in">this</span>.font = font;</span><br><span class="line">        <span class="built_in">this</span>.size = size;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">display</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y)</span> &#123;</span><br><span class="line">        System.out.printf(<span class="string">&quot;显示字符 [%s]（字体：%s，大小：%d）在位置 (%d, %d)\n&quot;</span>, </span><br><span class="line">                          charValue, font, size, x, y);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3. 享元工厂：管理共享对象池</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CharacterFactory</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Map&lt;String, Character&gt; pool = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Character <span class="title function_">getCharacter</span><span class="params">(String charValue, String font, <span class="type">int</span> size)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> charValue + font + size; <span class="comment">// 唯一标识内部状态</span></span><br><span class="line">        <span class="keyword">if</span> (!pool.containsKey(key)) &#123;</span><br><span class="line">            pool.put(key, <span class="keyword">new</span> <span class="title class_">ConcreteCharacter</span>(charValue, font, size));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> pool.get(key);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>客户端调用</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Client</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">// 获取共享字符对象（内部状态相同则复用）</span></span><br><span class="line">        <span class="type">Character</span> <span class="variable">a1</span> <span class="operator">=</span> CharacterFactory.getCharacter(<span class="string">&quot;A&quot;</span>, <span class="string">&quot;宋体&quot;</span>, <span class="number">12</span>);</span><br><span class="line">        <span class="type">Character</span> <span class="variable">a2</span> <span class="operator">=</span> CharacterFactory.getCharacter(<span class="string">&quot;A&quot;</span>, <span class="string">&quot;宋体&quot;</span>, <span class="number">12</span>); <span class="comment">// 复用对象</span></span><br><span class="line">        <span class="type">Character</span> <span class="variable">b</span> <span class="operator">=</span> CharacterFactory.getCharacter(<span class="string">&quot;B&quot;</span>, <span class="string">&quot;黑体&quot;</span>, <span class="number">14</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 使用不同外部状态（位置）</span></span><br><span class="line">        a1.display(<span class="number">10</span>, <span class="number">20</span>);</span><br><span class="line">        a2.display(<span class="number">30</span>, <span class="number">40</span>);</span><br><span class="line">        b.display(<span class="number">50</span>, <span class="number">60</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>JDK中的经典应用</strong></p>
<ul>
<li><p>**<code>Integer.valueOf(int)</code>**：缓存-128~127的Integer对象（通过<code>IntegerCache</code>）。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Integer</span> <span class="variable">a</span> <span class="operator">=</span> Integer.valueOf(<span class="number">127</span>); <span class="comment">// 从缓存获取</span></span><br><span class="line"><span class="type">Integer</span> <span class="variable">b</span> <span class="operator">=</span> Integer.valueOf(<span class="number">127</span>); <span class="comment">// 复用对象</span></span><br><span class="line">System.out.println(a == b); <span class="comment">// 输出 true</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><strong><code>String</code>常量池</strong>：相同字符串字面量指向同一内存地址。</p>
</li>
<li><p>**<code>Java.lang.ThreadLocal</code>**：线程级别的享元模式实现。</p>
</li>
</ul>
<p><strong>优缺点</strong></p>
<table>
<thead>
<tr>
<th align="left"><strong>优点</strong></th>
<th align="left"><strong>缺点</strong></th>
</tr>
</thead>
<tbody><tr>
<td align="left">显著减少内存占用</td>
<td align="left">增加系统复杂度（需区分内外状态）</td>
</tr>
<tr>
<td align="left">提升系统性能</td>
<td align="left">需要额外逻辑管理外部状态</td>
</tr>
<tr>
<td align="left">支持大规模对象集合</td>
<td align="left">可能引入线程安全问题</td>
</tr>
</tbody></table>
<p> <strong>关键点</strong></p>
<ul>
<li><strong>状态分离</strong>：<ul>
<li><strong>内部状态（Intrinsic State）</strong>：可共享的固有属性（如字符样式）。</li>
<li><strong>外部状态（Extrinsic State）</strong>：不可共享的上下文信息（如位置坐标）。</li>
</ul>
</li>
<li><strong>线程安全问题</strong>：享元对象需设计为不可变，否则共享时需同步控制。</li>
<li><strong>工厂管理</strong>：通过工厂类集中创建和缓存享元对象。</li>
<li><strong>与对象池区别</strong>：对象池管理生命周期，享元模式侧重状态共享。</li>
</ul>
<h2 id="对比其他模式"><a href="#对比其他模式" class="headerlink" title="对比其他模式"></a><strong>对比其他模式</strong></h2><table>
<thead>
<tr>
<th align="left"><strong>模式</strong></th>
<th align="left"><strong>核心目的</strong></th>
<th align="left"><strong>典型场景</strong></th>
</tr>
</thead>
<tbody><tr>
<td align="left"><strong>享元模式</strong></td>
<td align="left">减少内存消耗，共享对象</td>
<td align="left">字符渲染、粒子效果</td>
</tr>
<tr>
<td align="left"><strong>单例模式</strong></td>
<td align="left">确保类只有一个实例</td>
<td align="left">全局配置、日志对象</td>
</tr>
<tr>
<td align="left"><strong>原型模式</strong></td>
<td align="left">通过克隆快速创建对象</td>
<td align="left">复杂对象初始化优化</td>
</tr>
</tbody></table>
<p>享元模式通过“共享”与“复用”的核心理念，成为优化高并发、大规模对象场景的利器，是性能敏感型系统设计的必备工具。</p>
<h1 id="责任链模式"><a href="#责任链模式" class="headerlink" title="责任链模式"></a>责任链模式</h1><p><strong>产生背景</strong></p>
<ul>
<li><strong>多条件处理需求</strong>：一个请求需要经过多个对象的处理，但具体由哪个对象处理在运行时才能确定（如审批流程、异常处理链）。</li>
<li><strong>解耦请求与处理</strong>：避免请求发送者与多个处理者直接耦合，提升代码灵活性和可扩展性。</li>
<li><strong>动态调整流程</strong>：需要灵活添加、删除或调整处理节点的顺序（如中间件拦截器链）。</li>
</ul>
<p>责任链模式（<strong>Chain of Responsibility Pattern</strong>）是一种<strong>行为型设计模式</strong>，通过将多个处理对象连接成一条链，使请求沿着链传递，直到被某个对象处理为止。<br>核心思想是：<strong>每个处理对象持有下一个处理对象的引用</strong>，形成链条，请求在链上传递，处理者自行决定是否处理或转发请求。</p>
<h2 id="作用-11"><a href="#作用-11" class="headerlink" title="作用"></a><strong>作用</strong></h2><ul>
<li><strong>解耦请求与处理</strong>：发送者无需知道具体处理者。</li>
<li><strong>动态组合处理流程</strong>：可灵活调整链中节点的顺序或增减节点。</li>
<li><strong>增强扩展性</strong>：新增处理者无需修改现有代码（符合开闭原则）。</li>
<li><strong>多级处理机制</strong>：允许多个对象协作处理同一请求（如多层权限校验）。</li>
</ul>
<h2 id="使用场景-11"><a href="#使用场景-11" class="headerlink" title="使用场景"></a><strong>使用场景</strong></h2><ul>
<li><strong>多级审批流程</strong>：如请假审批（组长→经理→HR）。</li>
<li><strong>请求过滤链</strong>：如Web请求处理中的权限验证、日志记录、参数校验。</li>
<li><strong>异常处理</strong>：逐层捕获异常（方法级→类级→全局）。</li>
<li><strong>日志级别处理</strong>：不同日志级别（DEBUG &lt; INFO &lt; ERROR）由不同处理器处理。</li>
<li><strong>游戏事件传播</strong>：如点击事件被UI元素逐层处理。</li>
</ul>
<h2 id="经典简单实例-8"><a href="#经典简单实例-8" class="headerlink" title="经典简单实例"></a><strong>经典简单实例</strong></h2><p><strong>请假审批系统</strong></p>
<p><strong>场景描述</strong></p>
<p>员工提交请假申请，根据天数由不同级别的领导审批：</p>
<ul>
<li>≤3天：组长审批</li>
<li>≤7天：经理审批</li>
<li>＞7天：HR审批<br>使用责任链模式实现多级审批流程。</li>
</ul>
<p><strong>类结构设计</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1. 抽象处理者接口</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">Approver</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">setNextApprover</span><span class="params">(Approver nextApprover)</span>; <span class="comment">// 设置下一个处理者</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">handleRequest</span><span class="params">(<span class="type">int</span> days)</span>;                <span class="comment">// 处理请求</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. 具体处理者：组长</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">TeamLeader</span> <span class="keyword">implements</span> <span class="title class_">Approver</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Approver nextApprover;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setNextApprover</span><span class="params">(Approver nextApprover)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.nextApprover = nextApprover;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">handleRequest</span><span class="params">(<span class="type">int</span> days)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (days &lt;= <span class="number">3</span>) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;组长批准 &quot;</span> + days + <span class="string">&quot; 天假期&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (nextApprover != <span class="literal">null</span>) &#123;</span><br><span class="line">            nextApprover.handleRequest(days); <span class="comment">// 转交下一级</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3. 具体处理者：经理</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Manager</span> <span class="keyword">implements</span> <span class="title class_">Approver</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Approver nextApprover;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setNextApprover</span><span class="params">(Approver nextApprover)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.nextApprover = nextApprover;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">handleRequest</span><span class="params">(<span class="type">int</span> days)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (days &lt;= <span class="number">7</span>) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;经理批准 &quot;</span> + days + <span class="string">&quot; 天假期&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (nextApprover != <span class="literal">null</span>) &#123;</span><br><span class="line">            nextApprover.handleRequest(days);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 4. 具体处理者：HR</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">HR</span> <span class="keyword">implements</span> <span class="title class_">Approver</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setNextApprover</span><span class="params">(Approver nextApprover)</span> &#123;</span><br><span class="line">        <span class="comment">// HR是链条终点，无需设置下一级</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">handleRequest</span><span class="params">(<span class="type">int</span> days)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;HR批准 &quot;</span> + days + <span class="string">&quot; 天假期&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>客户端调用</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">// 1. 构建责任链：组长→经理→HR</span></span><br><span class="line">        <span class="type">Approver</span> <span class="variable">teamLeader</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TeamLeader</span>();</span><br><span class="line">        <span class="type">Approver</span> <span class="variable">manager</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Manager</span>();</span><br><span class="line">        <span class="type">Approver</span> <span class="variable">hr</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HR</span>();</span><br><span class="line"></span><br><span class="line">        teamLeader.setNextApprover(manager);</span><br><span class="line">        manager.setNextApprover(hr);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2. 提交不同天数的请假申请</span></span><br><span class="line">        teamLeader.handleRequest(<span class="number">2</span>);  <span class="comment">// 组长处理</span></span><br><span class="line">        teamLeader.handleRequest(<span class="number">5</span>);  <span class="comment">// 经理处理</span></span><br><span class="line">        teamLeader.handleRequest(<span class="number">10</span>); <span class="comment">// HR处理</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>关键点</strong></p>
<ul>
<li><strong>链条构建方式</strong>：可在客户端动态组装链，也可通过配置文件定义。</li>
<li><strong>终止条件</strong>：需明确链条终点（如示例中的HR节点）。</li>
<li><strong>纯与不纯责任链</strong>：<ul>
<li><strong>纯责任链</strong>：请求必须被某个处理者处理（如HTTP请求必须响应）。</li>
<li><strong>不纯责任链</strong>：请求可能未被处理（如示例中的请假审批）。</li>
</ul>
</li>
<li><strong>性能考量</strong>：长链可能导致请求传递时间增加。</li>
</ul>
<p><strong>优缺点</strong></p>
<table>
<thead>
<tr>
<th align="left"><strong>优点</strong></th>
<th align="left"><strong>缺点</strong></th>
</tr>
</thead>
<tbody><tr>
<td align="left">解耦请求发送者与处理者</td>
<td align="left">请求可能未被处理（需兜底逻辑）</td>
</tr>
<tr>
<td align="left">动态增删处理节点</td>
<td align="left">长链影响性能</td>
</tr>
<tr>
<td align="left">符合单一职责原则</td>
<td align="left">调试复杂度增加</td>
</tr>
</tbody></table>
<p>责任链模式通过解耦处理逻辑与执行顺序，为复杂校验场景提供了灵活、可扩展的解决方案。</p>
<p><strong>实际应用</strong></p>
<ul>
<li><strong>Java Servlet Filter</strong>：过滤器链依次处理HTTP请求。</li>
<li><strong>Spring Security</strong>：认证与授权过滤器链。</li>
<li><strong>日志框架</strong>：<code>Log4j</code>&#x2F;<code>Logback</code>的<code>Appender</code>链式处理日志事件。</li>
<li><strong>游戏引擎</strong>：事件处理链（如点击事件由UI组件逐层处理）。</li>
</ul>
<h1 id="命令模式"><a href="#命令模式" class="headerlink" title="命令模式"></a>命令模式</h1><p> <strong>产生背景</strong></p>
<ul>
<li><strong>解耦请求与执行</strong>：需要将操作请求的发起者（如按钮点击）与具体执行者（如设备操作）分离，避免直接依赖。</li>
<li><strong>支持撤销&#x2F;重做</strong>：需要记录操作历史，实现事务回滚或操作回退（如文档编辑器的撤销功能）。</li>
<li><strong>灵活扩展操作</strong>：希望动态添加新命令或批量执行多个命令（如宏命令、任务队列）。</li>
</ul>
<p>命令模式（<strong>Command Pattern</strong>）是一种<strong>行为型设计模式</strong>，通过将<strong>请求封装为独立的对象</strong>，使得可以用不同的请求参数化其他对象，并支持请求的排队、日志记录、撤销&#x2F;重做等操作。核心思想：<strong>将“操作请求”抽象为对象</strong>，解耦调用者与接收者。</p>
<h2 id="作用-12"><a href="#作用-12" class="headerlink" title="作用"></a><strong>作用</strong></h2><ul>
<li><strong>解耦调用者与接收者</strong>：调用者无需知道具体执行逻辑。</li>
<li><strong>支持事务操作</strong>：实现命令的撤销（Undo）、重做（Redo）。</li>
<li><strong>灵活组合命令</strong>：支持批量执行、延迟执行或日志记录。</li>
<li><strong>扩展性强</strong>：新增命令无需修改现有代码（符合开闭原则）。</li>
</ul>
<h2 id="使用场景-12"><a href="#使用场景-12" class="headerlink" title="使用场景"></a><strong>使用场景</strong></h2><ul>
<li><strong>GUI操作</strong>：如菜单项点击、按钮事件绑定不同功能。</li>
<li><strong>事务管理</strong>：数据库事务的提交与回滚。</li>
<li><strong>任务队列&#x2F;线程池</strong>：将任务封装为命令对象提交执行。</li>
<li><strong>遥控器&#x2F;智能家居</strong>：统一控制多个设备的开关。</li>
<li><strong>游戏开发</strong>：技能释放、操作回放。</li>
</ul>
<h2 id="经典简单实例-9"><a href="#经典简单实例-9" class="headerlink" title="经典简单实例"></a><strong>经典简单实例</strong></h2><p><strong>文本编辑器撤销操作</strong></p>
<p>设计一个简易文本编辑器，支持以下功能：</p>
<ol>
<li>用户输入文字时，内容实时更新。</li>
<li>每次编辑操作（如添加文字）可被撤销。<br>通过命令模式封装编辑操作，实现撤销功能。</li>
</ol>
<p><strong>类结构设计</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.Stack;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 1. 命令接口</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">TextCommand</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">execute</span><span class="params">()</span>;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">undo</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. 具体命令：添加文字</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">AddTextCommand</span> <span class="keyword">implements</span> <span class="title class_">TextCommand</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Document document;  <span class="comment">// 接收者</span></span><br><span class="line">    <span class="keyword">private</span> String text;        <span class="comment">// 操作内容</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> position;       <span class="comment">// 插入位置（简化场景，始终追加到末尾）</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">AddTextCommand</span><span class="params">(Document document, String text)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.document = document;</span><br><span class="line">        <span class="built_in">this</span>.text = text;</span><br><span class="line">        <span class="built_in">this</span>.position = document.getContent().length(); <span class="comment">// 记录插入位置</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">execute</span><span class="params">()</span> &#123;</span><br><span class="line">        document.addText(text);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">undo</span><span class="params">()</span> &#123;</span><br><span class="line">        document.deleteText(position, text.length());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3. 接收者：文档类</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Document</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">StringBuilder</span> <span class="variable">content</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addText</span><span class="params">(String text)</span> &#123;</span><br><span class="line">        content.append(text);</span><br><span class="line">        System.out.println(<span class="string">&quot;文档内容: &quot;</span> + content);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">deleteText</span><span class="params">(<span class="type">int</span> start, <span class="type">int</span> length)</span> &#123;</span><br><span class="line">        content.delete(start, start + length);</span><br><span class="line">        System.out.println(<span class="string">&quot;撤销后内容: &quot;</span> + content);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getContent</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> content.toString();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 4. 调用者：编辑历史管理器</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">EditHistory</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Stack&lt;TextCommand&gt; history = <span class="keyword">new</span> <span class="title class_">Stack</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">executeCommand</span><span class="params">(TextCommand command)</span> &#123;</span><br><span class="line">        command.execute();</span><br><span class="line">        history.push(command);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">undoLastCommand</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (!history.isEmpty()) &#123;</span><br><span class="line">            <span class="type">TextCommand</span> <span class="variable">lastCommand</span> <span class="operator">=</span> history.pop();</span><br><span class="line">            lastCommand.undo();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>客户端调用</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Client</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Document</span> <span class="variable">doc</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Document</span>();</span><br><span class="line">        <span class="type">EditHistory</span> <span class="variable">history</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">EditHistory</span>();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 用户输入操作</span></span><br><span class="line">        history.executeCommand(<span class="keyword">new</span> <span class="title class_">AddTextCommand</span>(doc, <span class="string">&quot;Hello&quot;</span>));</span><br><span class="line">        history.executeCommand(<span class="keyword">new</span> <span class="title class_">AddTextCommand</span>(doc, <span class="string">&quot; World!&quot;</span>));</span><br><span class="line">        history.executeCommand(<span class="keyword">new</span> <span class="title class_">AddTextCommand</span>(doc, <span class="string">&quot; 你好！&quot;</span>));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 连续撤销两次</span></span><br><span class="line">        history.undoLastCommand(); <span class="comment">// 撤销 &quot; 你好！&quot;</span></span><br><span class="line">        history.undoLastCommand(); <span class="comment">// 撤销 &quot; World!&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>优缺点</strong></p>
<table>
<thead>
<tr>
<th align="left"><strong>优点</strong></th>
<th align="left"><strong>缺点</strong></th>
</tr>
</thead>
<tbody><tr>
<td align="left">解耦操作请求与实现</td>
<td align="left">每个命令需单独定义类，可能增加代码量</td>
</tr>
<tr>
<td align="left">支持撤销&#x2F;重做、事务操作</td>
<td align="left">复杂撤销逻辑需额外状态管理</td>
</tr>
<tr>
<td align="left">易于扩展新命令</td>
<td align="left"></td>
</tr>
</tbody></table>
<h1 id="解释器模式"><a href="#解释器模式" class="headerlink" title="解释器模式"></a>解释器模式</h1><p><strong>产生背景</strong></p>
<ul>
<li><strong>特定语法解释需求</strong>：需要处理自定义语法或规则（如数学表达式、正则表达式、领域特定语言），并将其转换为可执行的操作。</li>
<li><strong>频繁解析场景</strong>：系统中存在大量需要动态解析的语句，传统硬编码解析方式难以维护和扩展。</li>
<li><strong>模块化解耦诉求</strong>：希望将语法规则分解为独立模块，提升代码复用性和可维护性。</li>
</ul>
<p>解释器模式（<strong>Interpreter Pattern</strong>）是一种<strong>行为型设计模式</strong>，通过定义语言的<strong>文法规则</strong>，并构建<strong>解释器</strong>来解释语言中的句子。核心思想：<strong>将语法规则表示为类层次结构</strong>，通过组合这些类实现语法解析。</p>
<h2 id="作用-13"><a href="#作用-13" class="headerlink" title="作用"></a><strong>作用</strong></h2><ul>
<li><strong>灵活解析语法</strong>：将复杂语法拆解为简单规则，逐层解释。</li>
<li><strong>易于扩展语法</strong>：新增语法规则只需添加新类，符合开闭原则。</li>
<li><strong>增强可读性</strong>：通过类结构直观表达语法逻辑。</li>
<li><strong>统一处理流程</strong>：为不同语法元素提供一致的解析接口。</li>
</ul>
<h2 id="使用场景-13"><a href="#使用场景-13" class="headerlink" title="使用场景"></a><strong>使用场景</strong></h2><ul>
<li><strong>数学表达式计算</strong>：如四则运算、布尔表达式求值。</li>
<li><strong>规则引擎</strong>：业务规则动态解析（如促销折扣规则）。</li>
<li><strong>脚本语言解释器</strong>：如自定义配置脚本、游戏技能脚本。</li>
<li><strong>SQL&#x2F;正则表达式解析</strong>：将字符串转换为可执行指令。</li>
<li><strong>编译器设计</strong>：构建抽象语法树（AST）进行代码分析。</li>
</ul>
<h2 id="经典简单实例-10"><a href="#经典简单实例-10" class="headerlink" title="经典简单实例"></a><strong>经典简单实例</strong></h2><p><strong>权限检查系统</strong></p>
<p>设计一个权限检查系统，根据用户属性动态解析规则，例如：</p>
<ul>
<li><code>&quot;role:admin&quot;</code> → 用户角色是否为管理员</li>
<li><code>&quot;department:finance AND level &gt;= 5&quot;</code> → 用户部门是财务部且级别≥5</li>
<li><code>&quot;role:editor OR (department:marketing AND level &gt; 3)&quot;</code> → 复合条件<br>通过解释器模式将规则字符串转换为可执行逻辑。</li>
</ul>
<p><strong>类结构设计</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 1. 抽象表达式接口</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">PermissionExpression</span> &#123;</span><br><span class="line">    <span class="type">boolean</span> <span class="title function_">interpret</span><span class="params">(Map&lt;String, String&gt; context)</span>; <span class="comment">// 上下文含用户信息</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. 终结符表达式：基础条件（如角色、部门）</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">TerminalExpression</span> <span class="keyword">implements</span> <span class="title class_">PermissionExpression</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String key;</span><br><span class="line">    <span class="keyword">private</span> String value;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">TerminalExpression</span><span class="params">(String rule)</span> &#123;</span><br><span class="line">        String[] parts = rule.split(<span class="string">&quot;:&quot;</span>); <span class="comment">// 解析&quot;key:value&quot;</span></span><br><span class="line">        <span class="built_in">this</span>.key = parts[<span class="number">0</span>].trim();</span><br><span class="line">        <span class="built_in">this</span>.value = parts[<span class="number">1</span>].trim();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">interpret</span><span class="params">(Map&lt;String, String&gt; context)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> context.get(key) != <span class="literal">null</span> &amp;&amp; context.get(key).equals(value);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3. 非终结符表达式：AND逻辑</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">AndExpression</span> <span class="keyword">implements</span> <span class="title class_">PermissionExpression</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> PermissionExpression expr1;</span><br><span class="line">    <span class="keyword">private</span> PermissionExpression expr2;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">AndExpression</span><span class="params">(PermissionExpression expr1, PermissionExpression expr2)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.expr1 = expr1;</span><br><span class="line">        <span class="built_in">this</span>.expr2 = expr2;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">interpret</span><span class="params">(Map&lt;String, String&gt; context)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> expr1.interpret(context) &amp;&amp; expr2.interpret(context);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 4. 非终结符表达式：OR逻辑</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">OrExpression</span> <span class="keyword">implements</span> <span class="title class_">PermissionExpression</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> PermissionExpression expr1;</span><br><span class="line">    <span class="keyword">private</span> PermissionExpression expr2;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">OrExpression</span><span class="params">(PermissionExpression expr1, PermissionExpression expr2)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.expr1 = expr1;</span><br><span class="line">        <span class="built_in">this</span>.expr2 = expr2;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">interpret</span><span class="params">(Map&lt;String, String&gt; context)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> expr1.interpret(context) || expr2.interpret(context);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>客户端调用</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 客户端构建规则树（此处简化解析过程）</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Client</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">// 用户上下文数据</span></span><br><span class="line">        Map&lt;String, String&gt; user = Map.of(</span><br><span class="line">            <span class="string">&quot;role&quot;</span>, <span class="string">&quot;editor&quot;</span>,</span><br><span class="line">            <span class="string">&quot;department&quot;</span>, <span class="string">&quot;marketing&quot;</span>,</span><br><span class="line">            <span class="string">&quot;level&quot;</span>, <span class="string">&quot;4&quot;</span></span><br><span class="line">        );</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 手动构建规则树：role:editor OR (department:marketing AND level &gt; 3)</span></span><br><span class="line">        <span class="type">PermissionExpression</span> <span class="variable">rule</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">OrExpression</span>(</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">TerminalExpression</span>(<span class="string">&quot;role:editor&quot;</span>),</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">AndExpression</span>(</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">TerminalExpression</span>(<span class="string">&quot;department:marketing&quot;</span>),</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">TerminalExpression</span>(<span class="string">&quot;level:4&quot;</span>) <span class="comment">// 实际需扩展比较操作符解析</span></span><br><span class="line">            )</span><br><span class="line">        );</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;权限检查结果: &quot;</span> + rule.interpret(user)); <span class="comment">// 输出 true</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="迭代器模型"><a href="#迭代器模型" class="headerlink" title="迭代器模型"></a>迭代器模型</h1><p> <strong>产生背景</strong></p>
<ul>
<li><strong>遍历需求多样化</strong>：集合对象（如列表、树、图）的遍历方式复杂多变（顺序遍历、逆序遍历、层级遍历），硬编码遍历逻辑会导致代码臃肿。</li>
<li><strong>解耦诉求</strong>：希望将集合的存储结构与遍历逻辑分离，避免客户端直接操作集合内部数据。</li>
<li><strong>统一访问接口</strong>：为不同类型的集合（数组、链表、哈希表）提供一致的遍历方式，简化客户端调用。</li>
</ul>
<p>迭代器模式（<strong>Iterator Pattern</strong>）是一种<strong>行为型设计模式</strong>，通过提供一种<strong>顺序访问聚合对象元素</strong>的方法，且<strong>不暴露其内部结构</strong>。<br>核心思想：<strong>将遍历行为抽象为独立迭代器对象</strong>，让客户端通过统一接口遍历不同集合。</p>
<h2 id="作用-14"><a href="#作用-14" class="headerlink" title="作用"></a><strong>作用</strong></h2><ul>
<li><strong>解耦集合与遍历逻辑</strong>：集合专注存储，迭代器专注遍历。</li>
<li><strong>支持多种遍历方式</strong>：可为同一集合提供不同迭代器（如正序、逆序）。</li>
<li><strong>简化集合接口</strong>：集合只需提供创建迭代器的方法，无需暴露内部结构。</li>
<li><strong>符合单一职责原则</strong>：分离数据存储与数据遍历职责。</li>
</ul>
<h2 id="使用场景-14"><a href="#使用场景-14" class="headerlink" title="使用场景"></a><strong>使用场景</strong></h2><ul>
<li><strong>封装复杂数据结构</strong>：如树形结构、图结构的遍历。</li>
<li><strong>统一遍历接口</strong>：让客户端以相同方式处理不同集合（如Java的<code>Iterable</code>接口）。</li>
<li><strong>延迟加载遍历</strong>：按需获取元素（如数据库查询结果分页遍历）。</li>
<li><strong>并行遍历支持</strong>：允许多个迭代器同时遍历同一集合。</li>
</ul>
<h2 id="经典简单实例-11"><a href="#经典简单实例-11" class="headerlink" title="经典简单实例"></a><strong>经典简单实例</strong></h2><p><strong>场景描述</strong></p>
<p>设计一个书籍集合类 <code>BookShelf</code>，内部使用数组存储书籍名称。通过迭代器模式实现遍历，隐藏底层数组结构。</p>
<p><strong>类结构设计</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1. 迭代器接口（定义遍历方法）</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">Iterator</span>&lt;T&gt; &#123;</span><br><span class="line">    <span class="type">boolean</span> <span class="title function_">hasNext</span><span class="params">()</span>;</span><br><span class="line">    T <span class="title function_">next</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. 集合接口（定义创建迭代器的方法）</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">Aggregate</span>&lt;T&gt; &#123;</span><br><span class="line">    Iterator&lt;T&gt; <span class="title function_">createIterator</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3. 具体集合类：书架</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">BookShelf</span> <span class="keyword">implements</span> <span class="title class_">Aggregate</span>&lt;String&gt; &#123;</span><br><span class="line">    <span class="keyword">private</span> String[] books;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> <span class="variable">size</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">BookShelf</span><span class="params">(<span class="type">int</span> capacity)</span> &#123;</span><br><span class="line">        books = <span class="keyword">new</span> <span class="title class_">String</span>[capacity];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addBook</span><span class="params">(String book)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (size &lt; books.length) &#123;</span><br><span class="line">            books[size++] = book;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Iterator&lt;String&gt; <span class="title function_">createIterator</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">BookShelfIterator</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 4. 具体迭代器（内部类，封装遍历逻辑）</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">class</span> <span class="title class_">BookShelfIterator</span> <span class="keyword">implements</span> <span class="title class_">Iterator</span>&lt;String&gt; &#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="type">int</span> <span class="variable">index</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">hasNext</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> index &lt; size;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> String <span class="title function_">next</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> books[index++];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>客户端遍历</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Client</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">BookShelf</span> <span class="variable">shelf</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BookShelf</span>(<span class="number">3</span>);</span><br><span class="line">        shelf.addBook(<span class="string">&quot;Design Patterns&quot;</span>);</span><br><span class="line">        shelf.addBook(<span class="string">&quot;Clean Code&quot;</span>);</span><br><span class="line">        shelf.addBook(<span class="string">&quot;Refactoring&quot;</span>);</span><br><span class="line"></span><br><span class="line">        Iterator&lt;String&gt; it = shelf.createIterator();</span><br><span class="line">        <span class="keyword">while</span> (it.hasNext()) &#123;</span><br><span class="line">            System.out.println(it.next());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p> <strong>关键点</strong></p>
<ul>
<li><strong>双重抽象</strong>：<ul>
<li><strong>集合接口</strong>（如<code>Aggregate</code>）定义创建迭代器的方法。</li>
<li><strong>迭代器接口</strong>（如<code>Iterator</code>）定义遍历方法（<code>hasNext</code>、<code>next</code>）。</li>
</ul>
</li>
<li><strong>封装遍历细节</strong>：迭代器内部持有集合的引用，并实现遍历逻辑（如数组索引递增）。</li>
<li><strong>线程安全</strong>：多个迭代器可独立遍历同一集合（每个迭代器维护自己的遍历状态）。</li>
</ul>
<p><strong>实际应用</strong></p>
<ul>
<li><strong>Java集合框架</strong>：<code>List</code>、<code>Set</code>等集合通过<code>iterator()</code>方法返回迭代器。</li>
<li><strong>数据库游标</strong>：逐行遍历查询结果。</li>
<li><strong>文件逐行读取</strong>：<code>BufferedReader</code>的<code>lines()</code>方法返回行迭代器。</li>
<li><strong>树结构遍历</strong>：提供深度优先、广度优先等不同迭代器。</li>
</ul>
<p><strong>优缺点</strong></p>
<table>
<thead>
<tr>
<th align="left"><strong>优点</strong></th>
<th align="left"><strong>缺点</strong></th>
</tr>
</thead>
<tbody><tr>
<td align="left">解耦集合与遍历逻辑</td>
<td align="left">增加类的数量（迭代器类）</td>
</tr>
<tr>
<td align="left">支持多种遍历策略</td>
<td align="left">简单集合使用迭代器可能过度设计</td>
</tr>
<tr>
<td align="left">隐藏集合内部实现细节</td>
<td align="left"></td>
</tr>
</tbody></table>
<h1 id="中介者模式"><a href="#中介者模式" class="headerlink" title="中介者模式"></a>中介者模式</h1><p> <strong>产生背景</strong></p>
<ul>
<li><strong>复杂对象交互</strong>：当多个对象之间存在大量直接通信（如GUI组件联动、多模块协作），对象间耦合度高，形成网状依赖结构，难以维护和扩展。</li>
<li><strong>协调逻辑分散</strong>：对象间的交互逻辑分散在各个类中，导致代码重复且难以统一管理。</li>
<li><strong>系统重构困难</strong>：新增或修改一个对象可能引发多个相关类的连锁改动，违背开闭原则。</li>
</ul>
<p>中介者模式（<strong>Mediator Pattern</strong>）是一种<strong>行为型设计模式</strong>，通过<strong>引入中介对象</strong>封装一组对象之间的交互，使其各对象不再显式相互引用，从而<strong>将网状依赖变为星型结构</strong>。核心思想：<strong>将多对多通信转化为一对多通信</strong>，中介者成为交互的中心枢纽。</p>
<h2 id="作用-15"><a href="#作用-15" class="headerlink" title="作用"></a><strong>作用</strong></h2><ul>
<li><strong>解耦对象关系</strong>：对象间不再直接依赖，只需与中介者交互。</li>
<li><strong>集中控制逻辑</strong>：交互规则统一维护在中介者中，便于修改和扩展。</li>
<li><strong>简化对象职责</strong>：各对象只需关注自身核心逻辑，无需处理协调任务。</li>
<li><strong>提升可维护性</strong>：新增对象只需与中介者交互，不影响其他对象。</li>
</ul>
<h2 id="使用场景-15"><a href="#使用场景-15" class="headerlink" title="使用场景"></a><strong>使用场景</strong></h2><ul>
<li><strong>GUI组件交互</strong>：如表单控件联动（选择省份后更新城市列表）。</li>
<li><strong>聊天室系统</strong>：用户通过聊天室服务器转发消息，而非直接互发。</li>
<li><strong>航班调度系统</strong>：协调飞机、跑道、塔台之间的通信。</li>
<li><strong>多模块协作</strong>：如电商系统中订单、库存、支付模块的交互。</li>
<li><strong>游戏角色交互</strong>：玩家、NPC、场景元素通过游戏引擎中介通信。</li>
</ul>
<h2 id="经典简单实例-12"><a href="#经典简单实例-12" class="headerlink" title="经典简单实例"></a><strong>经典简单实例</strong></h2><p><strong>聊天室系统</strong></p>
<p>实现一个聊天室系统，多个用户（<code>User</code>）发送消息时，不直接相互调用，而是通过中介者（<code>ChatRoom</code>）统一广播消息。</p>
<p><strong>类结构设计</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1. 中介者接口（定义通信方法）</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">ChatMediator</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">sendMessage</span><span class="params">(String message, User user)</span>;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">addUser</span><span class="params">(User user)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. 具体中介者：聊天室</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ChatRoom</span> <span class="keyword">implements</span> <span class="title class_">ChatMediator</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> List&lt;User&gt; users = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addUser</span><span class="params">(User user)</span> &#123;</span><br><span class="line">        users.add(user);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">sendMessage</span><span class="params">(String message, User sender)</span> &#123;</span><br><span class="line">        <span class="comment">// 广播消息给其他用户（排除发送者自身）</span></span><br><span class="line">        <span class="keyword">for</span> (User user : users) &#123;</span><br><span class="line">            <span class="keyword">if</span> (user != sender) &#123;</span><br><span class="line">                user.receive(message);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3. 抽象同事类（用户）</span></span><br><span class="line"><span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line">    <span class="keyword">protected</span> ChatMediator mediator;</span><br><span class="line">    <span class="keyword">protected</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">User</span><span class="params">(ChatMediator mediator, String name)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.mediator = mediator;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title function_">send</span><span class="params">(String message)</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title function_">receive</span><span class="params">(String message)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 4. 具体同事类：普通用户</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ChatUser</span> <span class="keyword">extends</span> <span class="title class_">User</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">ChatUser</span><span class="params">(ChatMediator mediator, String name)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(mediator, name);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">send</span><span class="params">(String message)</span> &#123;</span><br><span class="line">        System.out.println(name + <span class="string">&quot; 发送消息: &quot;</span> + message);</span><br><span class="line">        mediator.sendMessage(message, <span class="built_in">this</span>); <span class="comment">// 通过中介者转发</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">receive</span><span class="params">(String message)</span> &#123;</span><br><span class="line">        System.out.println(name + <span class="string">&quot; 收到消息: &quot;</span> + message);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>客户端调用</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Client</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">// 创建中介者（聊天室）</span></span><br><span class="line">        <span class="type">ChatMediator</span> <span class="variable">chatRoom</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ChatRoom</span>();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 创建用户并加入聊天室</span></span><br><span class="line">        <span class="type">User</span> <span class="variable">alice</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ChatUser</span>(chatRoom, <span class="string">&quot;Alice&quot;</span>);</span><br><span class="line">        <span class="type">User</span> <span class="variable">bob</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ChatUser</span>(chatRoom, <span class="string">&quot;Bob&quot;</span>);</span><br><span class="line">        <span class="type">User</span> <span class="variable">charlie</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ChatUser</span>(chatRoom, <span class="string">&quot;Charlie&quot;</span>);</span><br><span class="line">        chatRoom.addUser(alice);</span><br><span class="line">        chatRoom.addUser(bob);</span><br><span class="line">        chatRoom.addUser(charlie);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Alice发送消息，Bob和Charlie接收</span></span><br><span class="line">        alice.send(<span class="string">&quot;大家好！&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>关键点</strong></p>
<ul>
<li><strong>中介者中心化</strong>：所有通信必须经过中介者，对象间无直接依赖。</li>
<li><strong>星型拓扑结构</strong>：对象与中介者形成一对多关系（对比原始网状结构）。</li>
<li><strong>扩展性</strong>：新增用户只需注册到中介者，无需修改现有用户代码。</li>
<li><strong>与观察者模式区别</strong>：观察者模式侧重一对多通知，中介者模式侧重多对多协调。</li>
</ul>
<hr>
<p><strong>实际应用</strong></p>
<ul>
<li><strong>Java Swing</strong>：<code>Dialog</code> 作为中介者协调按钮、输入框等组件。</li>
<li><strong>Spring MVC</strong>：<code>DispatcherServlet</code> 协调控制器、视图解析器、处理器映射。</li>
<li><strong>航空调度系统</strong>：塔台协调飞机起飞、降落请求。</li>
<li><strong>企业级消息中间件</strong>：Kafka、RabbitMQ作为中介者解耦生产者和消费者。</li>
</ul>
<hr>
<p><strong>优缺点</strong></p>
<table>
<thead>
<tr>
<th align="left"><strong>优点</strong></th>
<th align="left"><strong>缺点</strong></th>
</tr>
</thead>
<tbody><tr>
<td align="left">大幅降低对象间耦合度</td>
<td align="left">中介者可能成为“上帝类”</td>
</tr>
<tr>
<td align="left">简化对象职责，提升可维护性</td>
<td align="left">中介者逻辑复杂化后难以维护</td>
</tr>
<tr>
<td align="left">支持集中式交互管理</td>
<td align="left">过度使用可能导致性能瓶颈</td>
</tr>
</tbody></table>
<hr>
<p>中介者模式通过<strong>中心化协调机制</strong>，将混乱的对象交互梳理为清晰的结构，是解决复杂通信场景的经典设计模式。</p>
<h1 id="备忘录模式"><a href="#备忘录模式" class="headerlink" title="备忘录模式"></a>备忘录模式</h1><p><strong>产生背景</strong></p>
<ul>
<li><strong>状态保存需求</strong>：需要记录对象在某个时刻的内部状态，以便后续可回溯（如文本编辑器的撤销操作、游戏存档）。</li>
<li><strong>封装性保护</strong>：直接暴露对象内部状态会破坏封装性，导致代码脆弱性和安全隐患。</li>
<li><strong>复杂状态管理</strong>：当对象状态变更路径复杂时，手动管理历史状态容易出错。</li>
</ul>
<p>备忘录模式（<strong>Memento Pattern</strong>）是一种<strong>行为型设计模式</strong>，允许在不破坏对象封装性的前提下，捕获并<strong>外部化对象的内部状态</strong>，以便后续可恢复到此状态。核心思想：<strong>将状态保存与恢复职责分离</strong>，通过专门对象（备忘录）管理历史状态。</p>
<h2 id="作用-16"><a href="#作用-16" class="headerlink" title="作用"></a><strong>作用</strong></h2><ul>
<li><strong>状态快照管理</strong>：提供系统化的状态保存&#x2F;恢复机制。</li>
<li><strong>保持封装性</strong>：不暴露对象内部实现细节。</li>
<li><strong>支持撤销&#x2F;重做</strong>：轻松实现多级撤销操作。</li>
<li><strong>简化原发器职责</strong>：状态管理逻辑由备忘录类承担。</li>
</ul>
<h2 id="使用场景-16"><a href="#使用场景-16" class="headerlink" title="使用场景"></a><strong>使用场景</strong></h2><ul>
<li><strong>文档&#x2F;编辑器</strong>：文本内容撤销与重做。</li>
<li><strong>游戏开发</strong>：角色状态存档&#x2F;读档。</li>
<li><strong>事务回滚</strong>：数据库操作失败时恢复至事务前状态。</li>
<li><strong>配置管理</strong>：系统配置修改后的版本回溯。</li>
<li><strong>绘图软件</strong>：画布操作历史记录。</li>
</ul>
<h2 id="经典简单实例-13"><a href="#经典简单实例-13" class="headerlink" title="经典简单实例"></a><strong>经典简单实例</strong></h2><p><strong>文本编辑器撤销功能</strong></p>
<p>实现一个文本编辑器，支持以下功能：</p>
<ol>
<li>用户输入文本内容。</li>
<li>每次输入后自动保存状态。</li>
<li>按 <code>Ctrl+Z</code> 可撤销到前一个状态。</li>
</ol>
<p><strong>类结构设计</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.Stack;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 1. 原发器（Originator）：需保存状态的对象</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">TextEditor</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String content; <span class="comment">// 需保存的状态</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 创建备忘录（保存当前状态）</span></span><br><span class="line">    <span class="keyword">public</span> TextMemento <span class="title function_">save</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">TextMemento</span>(content);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 从备忘录恢复状态</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">restore</span><span class="params">(TextMemento memento)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.content = memento.getSavedContent();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 业务方法：输入内容</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">write</span><span class="params">(String newContent)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.content = newContent;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">printContent</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;当前内容: &quot;</span> + content);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2. 备忘录（Memento）：内部类封装状态</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">TextMemento</span> &#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">final</span> String content;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">private</span> <span class="title function_">TextMemento</span><span class="params">(String content)</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.content = content;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">private</span> String <span class="title function_">getSavedContent</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> content;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3. 管理者（Caretaker）：管理备忘录栈</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">HistoryManager</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Stack&lt;TextEditor.TextMemento&gt; history = <span class="keyword">new</span> <span class="title class_">Stack</span>&lt;&gt;();</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">push</span><span class="params">(TextEditor.TextMemento memento)</span> &#123;</span><br><span class="line">        history.push(memento);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> TextEditor.TextMemento <span class="title function_">pop</span><span class="params">()</span> &#123;</span><br><span class="line">        history.pop()</span><br><span class="line">        <span class="keyword">return</span> history.peek();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>客户端调用</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Client</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">TextEditor</span> <span class="variable">editor</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TextEditor</span>();</span><br><span class="line">        <span class="type">HistoryManager</span> <span class="variable">history</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HistoryManager</span>();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 第1次输入并保存</span></span><br><span class="line">        editor.write(<span class="string">&quot;Hello&quot;</span>);</span><br><span class="line">        history.push(editor.save());</span><br><span class="line">        editor.printContent(); <span class="comment">// 当前内容: Hello</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 第2次输入并保存</span></span><br><span class="line">        editor.write(<span class="string">&quot;Hello World&quot;</span>);</span><br><span class="line">        history.push(editor.save());</span><br><span class="line">        editor.printContent(); <span class="comment">// 当前内容: Hello World</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 撤销到第1次状态</span></span><br><span class="line"></span><br><span class="line">        editor.restore(history.pop());</span><br><span class="line">        editor.printContent(); <span class="comment">// 当前内容: Hello</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>关键点</strong></p>
<ul>
<li><strong>三层角色</strong>：<ul>
<li><strong>Originator（原发器）</strong>：产生状态变化的对象（如<code>TextEditor</code>）。</li>
<li><strong>Memento（备忘录）</strong>：存储原发器状态的快照（如<code>TextMemento</code>）。</li>
<li><strong>Caretaker（管理者）</strong>：存储和管理备忘录栈（如<code>HistoryManager</code>）。</li>
</ul>
</li>
<li><strong>封装保护</strong>：备忘录类的构造方法和状态访问权限设置为 <code>private</code> 或包级私有，仅允许原发器访问。</li>
<li><strong>状态存储策略</strong>：可使用栈实现多级撤销，或链表实现任意跳转。</li>
<li><strong>性能优化</strong>：对于大对象，可采用增量存储或压缩技术。</li>
</ul>
<p><strong>实际应用</strong></p>
<ul>
<li><strong>IDE撤销操作</strong>：IntelliJ&#x2F;VSCode的代码编辑历史回溯。</li>
<li><strong>游戏存档系统</strong>：保存玩家位置、装备、任务进度。</li>
<li><strong>浏览器回退</strong>：网页浏览历史状态管理。</li>
<li><strong>金融交易系统</strong>：交易失败时回滚到前一个合法状态。</li>
</ul>
<p><strong>优缺点</strong></p>
<table>
<thead>
<tr>
<th align="left"><strong>优点</strong></th>
<th align="left"><strong>缺点</strong></th>
</tr>
</thead>
<tbody><tr>
<td align="left">完美保护对象封装性</td>
<td align="left">频繁保存状态可能消耗内存</td>
</tr>
<tr>
<td align="left">简化原发器状态管理逻辑</td>
<td align="left">需要额外设计备忘录存储策略</td>
</tr>
<tr>
<td align="left">支持灵活的历史状态管理机制</td>
<td align="left"></td>
</tr>
</tbody></table>
<p><strong>对比其他模式</strong></p>
<table>
<thead>
<tr>
<th align="left"><strong>模式</strong></th>
<th align="left"><strong>核心目的</strong></th>
<th align="left"><strong>典型场景</strong></th>
</tr>
</thead>
<tbody><tr>
<td align="left"><strong>备忘录模式</strong></td>
<td align="left">对象状态保存与恢复</td>
<td align="left">撤销操作、事务回滚</td>
</tr>
<tr>
<td align="left"><strong>命令模式</strong></td>
<td align="left">封装操作为对象，支持撤销&#x2F;重做</td>
<td align="left">任务队列、操作历史</td>
</tr>
</tbody></table>
<p>备忘录模式通过<strong>状态外部化存储</strong>和<strong>严格的封装保护</strong>，为需要历史回溯能力的系统提供了优雅解决方案，是构建健壮撤销&#x2F;重做功能的黄金标准。</p>
<h1 id="观察者模式"><a href="#观察者模式" class="headerlink" title="观察者模式"></a>观察者模式</h1><p><strong>产生背景</strong></p>
<ul>
<li><strong>状态同步需求</strong>：当一个对象（目标对象）的状态改变时，需要自动通知其他依赖对象（观察者），并保持状态一致（如股票价格变动通知股民）。</li>
<li><strong>解耦需求</strong>：避免目标对象与观察者之间的直接硬编码调用，降低系统耦合度。</li>
<li><strong>动态订阅机制</strong>：需要支持观察者的灵活注册与移除（如用户随时关注&#x2F;取消关注公众号）。</li>
</ul>
<p>观察者模式（<strong>Observer Pattern</strong>）是一种<strong>行为型设计模式</strong>，定义对象间的<strong>一对多依赖关系</strong>，当一个对象（Subject）状态改变时，所有依赖它的对象（Observers）自动收到通知并更新。<br>核心思想：<strong>状态变化通知机制</strong> + <strong>松耦合设计</strong>。</p>
<h2 id="作用-17"><a href="#作用-17" class="headerlink" title="作用"></a><strong>作用</strong></h2><ul>
<li><strong>解耦观察者与被观察者</strong>：Subject无需知道具体Observer类型。</li>
<li><strong>支持广播通信</strong>：一个Subject变化可通知多个Observer。</li>
<li><strong>动态订阅关系</strong>：运行时可灵活添加&#x2F;删除Observer。</li>
<li><strong>符合开闭原则</strong>：新增Observer无需修改Subject代码。</li>
</ul>
<h2 id="使用场景-17"><a href="#使用场景-17" class="headerlink" title="使用场景"></a><strong>使用场景</strong></h2><ul>
<li><strong>事件驱动系统</strong>：如GUI按钮点击事件、前端框架（React&#x2F;Vue）的数据响应。</li>
<li><strong>实时数据推送</strong>：股票行情、天气预报更新。</li>
<li><strong>发布-订阅模型</strong>：消息队列（Kafka、RabbitMQ）、社交媒体关注机制。</li>
<li><strong>状态监控</strong>：服务器健康状态检测、日志监控系统。</li>
</ul>
<h2 id="经典简单实例-14"><a href="#经典简单实例-14" class="headerlink" title="经典简单实例"></a><strong>经典简单实例</strong></h2><p><strong>天气站数据推送</strong></p>
<p>气象站（<code>WeatherStation</code>）监测温度变化，实时通知多个显示设备（<code>PhoneDisplay</code>、<code>TVDisplay</code>）更新温度数据。</p>
<p><strong>类结构设计</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 1. 主题接口（Subject）</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">WeatherSubject</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">registerObserver</span><span class="params">(WeatherObserver o)</span>;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">removeObserver</span><span class="params">(WeatherObserver o)</span>;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">notifyObservers</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. 观察者接口（Observer）</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">WeatherObserver</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">update</span><span class="params">(<span class="type">int</span> temperature)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3. 具体主题：气象站</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">WeatherStation</span> <span class="keyword">implements</span> <span class="title class_">WeatherSubject</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> temperature;</span><br><span class="line">    <span class="keyword">private</span> List&lt;WeatherObserver&gt; observers = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setTemperature</span><span class="params">(<span class="type">int</span> temp)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.temperature = temp;</span><br><span class="line">        notifyObservers(); <span class="comment">// 温度变化时自动通知观察者</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">registerObserver</span><span class="params">(WeatherObserver o)</span> &#123;</span><br><span class="line">        observers.add(o);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">removeObserver</span><span class="params">(WeatherObserver o)</span> &#123;</span><br><span class="line">        observers.remove(o);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">notifyObservers</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (WeatherObserver o : observers) &#123;</span><br><span class="line">            o.update(temperature);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 4. 具体观察者：手机显示</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">PhoneDisplay</span> <span class="keyword">implements</span> <span class="title class_">WeatherObserver</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">update</span><span class="params">(<span class="type">int</span> temperature)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;手机显示温度更新: &quot;</span> + temperature + <span class="string">&quot;°C&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 5. 具体观察者：电视显示</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">TVDisplay</span> <span class="keyword">implements</span> <span class="title class_">WeatherObserver</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">update</span><span class="params">(<span class="type">int</span> temperature)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;电视显示温度更新: &quot;</span> + temperature + <span class="string">&quot;°C&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>客户端调用</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Client</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">// 创建主题（气象站）</span></span><br><span class="line">        <span class="type">WeatherStation</span> <span class="variable">station</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">WeatherStation</span>();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 创建观察者（显示设备）</span></span><br><span class="line">        <span class="type">WeatherObserver</span> <span class="variable">phone</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PhoneDisplay</span>();</span><br><span class="line">        <span class="type">WeatherObserver</span> <span class="variable">tv</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TVDisplay</span>();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 注册观察者</span></span><br><span class="line">        station.registerObserver(phone);</span><br><span class="line">        station.registerObserver(tv);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 模拟温度变化</span></span><br><span class="line">        station.setTemperature(<span class="number">25</span>); <span class="comment">// 自动通知所有观察者</span></span><br><span class="line">        station.setTemperature(<span class="number">30</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 移除一个观察者</span></span><br><span class="line">        station.removeObserver(tv);</span><br><span class="line">        station.setTemperature(<span class="number">28</span>); <span class="comment">// 仅通知手机</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>关键点</strong></p>
<ul>
<li><strong>推拉模型选择</strong>：<ul>
<li><strong>推模式</strong>（如上例）：Subject主动推送完整数据（<code>update(temp)</code>）。</li>
<li><strong>拉模式</strong>：Observer收到通知后，主动从Subject拉取所需数据（<code>update()</code>内调用<code>subject.getTemp()</code>）。</li>
</ul>
</li>
<li><strong>线程安全</strong>：多线程环境下需对观察者列表进行同步控制。</li>
<li><strong>避免循环依赖</strong>：Observer中不宜直接反向调用Subject方法。</li>
<li><strong>JDK内置支持</strong>：Java提供<code>java.util.Observable</code>类和<code>Observer</code>接口（已过时，建议自定义实现）。</li>
</ul>
<p><strong>实际应用</strong></p>
<ul>
<li><strong>Java Swing</strong>：<code>Button.addActionListener()</code>实现点击事件监听。</li>
<li><strong>Spring事件机制</strong>：<code>ApplicationEventPublisher</code>发布事件，<code>@EventListener</code>方法处理。</li>
<li><strong>RxJava</strong>：基于观察者模式的响应式编程库。</li>
<li><strong>前端框架</strong>：Vue的<code>v-model</code>双向数据绑定、React的<code>useState</code>状态管理。</li>
</ul>
<p><strong>优缺点</strong></p>
<table>
<thead>
<tr>
<th align="left"><strong>优点</strong></th>
<th align="left"><strong>缺点</strong></th>
</tr>
</thead>
<tbody><tr>
<td align="left">解耦生产者与消费者</td>
<td align="left">观察者过多时通知效率低</td>
</tr>
<tr>
<td align="left">支持动态订阅关系</td>
<td align="left">观察者处理阻塞会导致整体延迟</td>
</tr>
<tr>
<td align="left">符合开闭原则</td>
<td align="left">不当使用可能引起内存泄漏</td>
</tr>
</tbody></table>
<p>观察者模式通过<strong>松耦合的通知机制</strong>，为对象间动态联动提供了优雅解决方案，是事件驱动架构的基石设计模式。</p>
<h1 id="状态模式"><a href="#状态模式" class="headerlink" title="状态模式"></a>状态模式</h1><p><strong>产生背景</strong></p>
<ul>
<li><strong>复杂状态流转</strong>：对象行为随内部状态改变而改变（如订单状态从”待支付”→”已发货”→”已完成”），传统<code>if-else</code>或<code>switch</code>判断导致代码臃肿。</li>
<li><strong>可维护性问题</strong>：状态变更逻辑分散在多个方法中，新增状态需修改大量现有代码，违反开闭原则。</li>
<li><strong>行为动态切换</strong>：需要运行时根据状态动态调整对象行为（如电梯运行&#x2F;停止&#x2F;故障状态下的不同响应）。</li>
</ul>
<p>状态模式（<strong>State Pattern</strong>）是一种<strong>行为型设计模式</strong>，允许对象在<strong>内部状态改变时改变其行为</strong>，使对象看起来像是修改了它的类。<br>核心思想：<strong>将状态抽象为独立类</strong>，通过委托给当前状态对象实现行为切换。</p>
<h2 id="作用-18"><a href="#作用-18" class="headerlink" title="作用"></a><strong>作用</strong></h2><ul>
<li><strong>消除条件分支</strong>：用多态代替状态判断逻辑。</li>
<li><strong>集中状态逻辑</strong>：每个状态的行为封装在对应的状态类中。</li>
<li><strong>简化上下文类</strong>：上下文（Context）只需维护当前状态引用。</li>
<li><strong>易于扩展</strong>：新增状态只需添加新状态类，无需修改现有代码。</li>
</ul>
<h2 id="使用场景-18"><a href="#使用场景-18" class="headerlink" title="使用场景"></a><strong>使用场景</strong></h2><ul>
<li><strong>状态决定行为</strong>：如电梯、交通灯、游戏角色状态（站立&#x2F;奔跑&#x2F;跳跃）。</li>
<li><strong>复杂状态机</strong>：如订单生命周期、工作流审批。</li>
<li><strong>替代多层条件语句</strong>：当状态判断逻辑过于复杂时。</li>
<li><strong>UI控件交互</strong>：按钮的禁用&#x2F;悬停&#x2F;点击态。</li>
</ul>
<h2 id="经典简单实例-15"><a href="#经典简单实例-15" class="headerlink" title="经典简单实例"></a><strong>经典简单实例</strong></h2><p><strong>电风扇档位控制</strong></p>
<p>实现一个电风扇控制器，包含三个档位：</p>
<ul>
<li><strong>关闭状态</strong>：按下按钮切换到低速档</li>
<li><strong>低速档</strong>：按下按钮切换到中速档</li>
<li><strong>中速档</strong>：按下按钮切换到高速档</li>
<li><strong>高速档</strong>：按下按钮关闭风扇</li>
</ul>
<p><strong>类结构设计</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1. 状态接口</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">FanState</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">handleRequest</span><span class="params">(FanContext context)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. 具体状态类：关闭状态</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">OffState</span> <span class="keyword">implements</span> <span class="title class_">FanState</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">handleRequest</span><span class="params">(FanContext context)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;风扇从关闭切换到低速&quot;</span>);</span><br><span class="line">        context.setState(<span class="keyword">new</span> <span class="title class_">LowState</span>());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3. 具体状态类：低速状态</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">LowState</span> <span class="keyword">implements</span> <span class="title class_">FanState</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">handleRequest</span><span class="params">(FanContext context)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;风扇从低速切换到中速&quot;</span>);</span><br><span class="line">        context.setState(<span class="keyword">new</span> <span class="title class_">MediumState</span>());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 4. 具体状态类：中速状态</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MediumState</span> <span class="keyword">implements</span> <span class="title class_">FanState</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">handleRequest</span><span class="params">(FanContext context)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;风扇从中速切换到高速&quot;</span>);</span><br><span class="line">        context.setState(<span class="keyword">new</span> <span class="title class_">HighState</span>());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 5. 具体状态类：高速状态</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">HighState</span> <span class="keyword">implements</span> <span class="title class_">FanState</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">handleRequest</span><span class="params">(FanContext context)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;风扇从高速切换到关闭&quot;</span>);</span><br><span class="line">        context.setState(<span class="keyword">new</span> <span class="title class_">OffState</span>());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 6. 上下文类（电风扇）</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">FanContext</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> FanState currentState;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">FanContext</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.currentState = <span class="keyword">new</span> <span class="title class_">OffState</span>(); <span class="comment">// 初始状态</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setState</span><span class="params">(FanState state)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.currentState = state;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">pressButton</span><span class="params">()</span> &#123;</span><br><span class="line">        currentState.handleRequest(<span class="built_in">this</span>); <span class="comment">// 委托给当前状态处理</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>客户端实现</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Client</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">FanContext</span> <span class="variable">fan</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FanContext</span>();</span><br><span class="line">        </span><br><span class="line">        fan.pressButton(); <span class="comment">// 关闭 → 低速</span></span><br><span class="line">        fan.pressButton(); <span class="comment">// 低速 → 中速</span></span><br><span class="line">        fan.pressButton(); <span class="comment">// 中速 → 高速</span></span><br><span class="line">        fan.pressButton(); <span class="comment">// 高速 → 关闭</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>关键点</strong></p>
<ul>
<li><strong>状态转换方式</strong>：<ul>
<li><strong>由Context决定</strong>（集中管理转换逻辑）。</li>
<li><strong>由具体状态类决定</strong>（如示例中每个状态知道下一个状态）。</li>
<li><strong>通过外部输入决定</strong>（如根据参数选择下一状态）。</li>
</ul>
</li>
<li><strong>共享状态对象</strong>：若状态无实例变量，可设计为单例（如<code>HighState.INSTANCE</code>）。</li>
<li><strong>与策略模式区别</strong>：策略模式是主动切换算法，状态模式是被动响应状态变化。</li>
</ul>
<table>
<thead>
<tr>
<th align="left"><strong>优点</strong></th>
<th align="left"><strong>缺点</strong></th>
</tr>
</thead>
<tbody><tr>
<td align="left">消除复杂条件分支</td>
<td align="left">状态类数量可能过多</td>
</tr>
<tr>
<td align="left">集中状态相关行为</td>
<td align="left">状态转换逻辑分散</td>
</tr>
<tr>
<td align="left">符合单一职责和开闭原则</td>
<td align="left">小规模状态机可能过度设计</td>
</tr>
</tbody></table>
<p>状态模式通过<strong>将状态对象化</strong>和<strong>行为委托</strong>，为复杂状态管理提供了清晰的可扩展方案，是处理状态驱动型逻辑的利器。</p>
<h1 id="策略模式"><a href="#策略模式" class="headerlink" title="策略模式"></a>策略模式</h1><p> <strong>产生背景</strong></p>
<ul>
<li><strong>算法多样化需求</strong>：同一功能需要多种实现方式（如排序算法、支付方式），硬编码多种实现会导致代码臃肿。</li>
<li><strong>避免条件分支膨胀</strong>：使用大量<code>if-else</code>或<code>switch</code>选择不同算法，难以维护和扩展。</li>
<li><strong>运行时灵活切换</strong>：需要在程序运行时动态切换算法实现（如根据性能需求切换排序策略）。</li>
</ul>
<p>策略模式（<strong>Strategy Pattern</strong>）是一种<strong>行为型设计模式</strong>，定义<strong>一系列算法</strong>，将每个算法封装起来，并使它们可以<strong>相互替换</strong>。策略模式让算法的变化独立于使用算法的客户端。<br>核心思想：<strong>抽象算法接口</strong> + <strong>委托调用</strong>。</p>
<h2 id="作用-19"><a href="#作用-19" class="headerlink" title="作用"></a><strong>作用</strong></h2><ul>
<li><strong>解耦算法与使用方</strong>：客户端依赖抽象策略，而非具体实现。</li>
<li><strong>灵活扩展算法</strong>：新增算法无需修改现有代码（符合开闭原则）。</li>
<li><strong>消除条件语句</strong>：用多态代替条件判断。</li>
<li><strong>运行时动态切换</strong>：可根据需求切换不同策略。</li>
</ul>
<h2 id="使用场景-19"><a href="#使用场景-19" class="headerlink" title="使用场景"></a><strong>使用场景</strong></h2><ul>
<li><strong>多种算法变体</strong>：如排序（快速排序、归并排序）、压缩（ZIP、RAR）、加密（AES、DES）。</li>
<li><strong>支付方式选择</strong>：微信支付、支付宝、银联等。</li>
<li><strong>游戏技能系统</strong>：不同角色使用不同攻击策略。</li>
<li><strong>运费计算规则</strong>：根据地区、重量等动态选择计算方式。</li>
</ul>
<h2 id="经典简单实例-16"><a href="#经典简单实例-16" class="headerlink" title="经典简单实例"></a><strong>经典简单实例</strong></h2><p><strong>电商支付策略</strong>、</p>
<p>电商系统支持多种支付方式（支付宝、微信支付、信用卡），根据不同用户选择调用不同支付接口。</p>
<p><strong>类结构设计</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1. 抽象策略接口</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">PaymentStrategy</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">pay</span><span class="params">(<span class="type">double</span> amount)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. 具体策略类：支付宝支付</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">AlipayStrategy</span> <span class="keyword">implements</span> <span class="title class_">PaymentStrategy</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">pay</span><span class="params">(<span class="type">double</span> amount)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;使用支付宝支付: &quot;</span> + amount + <span class="string">&quot;元&quot;</span>);</span><br><span class="line">        <span class="comment">// 调用支付宝SDK...</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3. 具体策略类：微信支付</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">WechatPayStrategy</span> <span class="keyword">implements</span> <span class="title class_">PaymentStrategy</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">pay</span><span class="params">(<span class="type">double</span> amount)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;使用微信支付: &quot;</span> + amount + <span class="string">&quot;元&quot;</span>);</span><br><span class="line">        <span class="comment">// 调用微信支付API...</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 4. 上下文类（购物车）</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ShoppingCart</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> PaymentStrategy paymentStrategy;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setPaymentStrategy</span><span class="params">(PaymentStrategy strategy)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.paymentStrategy = strategy;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">checkout</span><span class="params">(<span class="type">double</span> amount)</span> &#123;</span><br><span class="line">        paymentStrategy.pay(amount); <span class="comment">// 委托给具体策略执行</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>客户端调用</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Client</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">ShoppingCart</span> <span class="variable">cart</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ShoppingCart</span>();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 用户选择支付宝支付</span></span><br><span class="line">        cart.setPaymentStrategy(<span class="keyword">new</span> <span class="title class_">AlipayStrategy</span>());</span><br><span class="line">        cart.checkout(<span class="number">100.0</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 用户切换为微信支付</span></span><br><span class="line">        cart.setPaymentStrategy(<span class="keyword">new</span> <span class="title class_">WechatPayStrategy</span>());</span><br><span class="line">        cart.checkout(<span class="number">200.0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>关键点</strong></p>
<ul>
<li><strong>策略抽象</strong>：所有策略实现同一接口，保证可互换性。</li>
<li><strong>上下文委托</strong>：上下文类持有策略引用，通过委托调用具体策略。</li>
<li><strong>无状态策略</strong>：若策略无需维护状态，可设计为单例（如<code>AlipayStrategy.INSTANCE</code>）。</li>
<li><strong>与工厂模式结合</strong>：通过工厂创建具体策略对象，进一步解耦。</li>
</ul>
<table>
<thead>
<tr>
<th align="left"><strong>优点</strong></th>
<th align="left"><strong>缺点</strong></th>
</tr>
</thead>
<tbody><tr>
<td align="left">灵活切换算法实现</td>
<td align="left">客户端需了解不同策略差异</td>
</tr>
<tr>
<td align="left">避免多重条件判断</td>
<td align="left">策略类数量可能过多</td>
</tr>
<tr>
<td align="left">符合开闭原则</td>
<td align="left">增加对象创建开销</td>
</tr>
</tbody></table>
<p><strong>状态模式 vs 策略模式</strong></p>
<table>
<thead>
<tr>
<th align="left"><strong>模式</strong></th>
<th align="left"><strong>核心目的</strong></th>
<th align="left"><strong>典型场景</strong></th>
</tr>
</thead>
<tbody><tr>
<td align="left"><strong>策略模式</strong></td>
<td align="left">灵活切换算法</td>
<td align="left">支付方式、排序算法</td>
</tr>
<tr>
<td align="left"><strong>状态模式</strong></td>
<td align="left">状态驱动行为变化</td>
<td align="left">订单状态机、电梯控制</td>
</tr>
</tbody></table>
<p>策略模式通过<strong>算法抽象</strong>和<strong>委托调用</strong>，为灵活多变的业务需求提供了优雅的扩展方案，是应对算法变化的经典设计模式。</p>
<h1 id="模板方法模式"><a href="#模板方法模式" class="headerlink" title="模板方法模式"></a>模板方法模式</h1><p><strong>产生背景</strong></p>
<ul>
<li><strong>流程标准化需求</strong>：多个相似操作具有固定流程步骤，但某些步骤的具体实现可能不同（如制作饮料的冲泡流程）。</li>
<li><strong>代码复用痛点</strong>：相同流程代码在多处重复，修改时需要同步更新所有副本，容易出错。</li>
<li><strong>扩展控制需求</strong>：需要固定核心流程架构，同时允许子类灵活扩展特定步骤。</li>
</ul>
<p>模板方法模式（<strong>Template Method Pattern</strong>）是一种<strong>行为型设计模式</strong>，在抽象类中定义一个操作中的<strong>算法骨架</strong>，将某些步骤<strong>延迟到子类</strong>实现。核心思想：<strong>父类定义流程框架</strong> + <strong>子类实现可变步骤</strong>。</p>
<h2 id="作用-20"><a href="#作用-20" class="headerlink" title="作用"></a><strong>作用</strong></h2><ul>
<li><strong>封装不变流程</strong>：固定算法结构，避免重复代码。</li>
<li><strong>保护核心流程</strong>：通过<code>final</code>防止子类重写模板方法。</li>
<li><strong>灵活扩展</strong>：子类只需关注差异化实现。</li>
<li><strong>反向控制</strong>：父类调用子类操作（好莱坞原则：”Don’t call us, we’ll call you”）。</li>
</ul>
<h2 id="使用场景-20"><a href="#使用场景-20" class="headerlink" title="使用场景"></a><strong>使用场景</strong></h2><ul>
<li><strong>固定流程业务</strong>：如文档导出（准备数据→生成文件→上传云存储）、支付流程（验签→扣款→通知）。</li>
<li><strong>框架设计</strong>：Spring的<code>JdbcTemplate</code>、Servlet的<code>service()</code>方法。</li>
<li><strong>测试用例</strong>：测试前置准备→执行→清理的标准化流程。</li>
<li><strong>游戏开发</strong>：游戏角色的固定行为流程（移动→攻击→结算）。</li>
</ul>
<h2 id="经典简单实例-17"><a href="#经典简单实例-17" class="headerlink" title="经典简单实例"></a><strong>经典简单实例</strong></h2><p><strong>饮料制作流程</strong></p>
<p>咖啡和茶的制作流程类似但存在差异：</p>
<ol>
<li><strong>咖啡</strong>：烧水→冲泡咖啡→加糖牛奶→倒入杯子</li>
<li><strong>茶</strong>：烧水→浸泡茶叶→加柠檬→倒入杯子<br>抽象出公共流程，差异化步骤由子类实现。</li>
</ol>
<p><strong>类结构设计</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1. 抽象模板类</span></span><br><span class="line"><span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">BeverageTemplate</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 模板方法（final防止子类覆盖）</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title function_">prepareBeverage</span><span class="params">()</span> &#123;</span><br><span class="line">        boilWater();</span><br><span class="line">        brew();</span><br><span class="line">        addCondiments();</span><br><span class="line">        pourInCup();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 公共步骤</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">boilWater</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;烧水&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">pourInCup</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;倒入杯子&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 抽象方法（子类必须实现）</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title function_">brew</span><span class="params">()</span>;</span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title function_">addCondiments</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. 具体子类：咖啡</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Coffee</span> <span class="keyword">extends</span> <span class="title class_">BeverageTemplate</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">brew</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;冲泡咖啡粉&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">addCondiments</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;加糖和牛奶&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3. 具体子类：茶</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Tea</span> <span class="keyword">extends</span> <span class="title class_">BeverageTemplate</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">brew</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;浸泡茶叶&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">addCondiments</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;加柠檬片&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>客户端调用</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Client</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;制作咖啡:&quot;</span>);</span><br><span class="line">        <span class="type">BeverageTemplate</span> <span class="variable">coffee</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Coffee</span>();</span><br><span class="line">        coffee.prepareBeverage();</span><br><span class="line">        </span><br><span class="line">        System.out.println(<span class="string">&quot;\n制作茶:&quot;</span>);</span><br><span class="line">        <span class="type">BeverageTemplate</span> <span class="variable">tea</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Tea</span>();</span><br><span class="line">        tea.prepareBeverage();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>关键点</strong></p>
<ul>
<li><strong>模板方法声明为final</strong>：保护算法结构不被子类修改。</li>
<li><strong>钩子方法（Hook）</strong>：提供默认空实现的非抽象方法，子类可选择覆盖（如<code>customerWantsCondiments()</code>控制是否加调料）。</li>
<li><strong>好莱坞原则</strong>：父类控制流程，子类被动提供实现。</li>
<li><strong>与策略模式对比</strong>：策略模式通过组合切换完整算法，模板方法通过继承定制部分步骤。</li>
</ul>
<p><strong>实际应用</strong></p>
<ul>
<li><strong>Java I&#x2F;O</strong>：<code>InputStream</code>的<code>read()</code>方法（模板方法）调用<code>read(byte[], int, int)</code>（子类实现）。</li>
<li><strong>Servlet生命周期</strong>：<code>HttpServlet</code>的<code>service()</code>方法调度<code>doGet()</code>&#x2F;<code>doPost()</code>。</li>
<li><strong>JUnit测试</strong>：<code>setUp()</code>→<code>testXxx()</code>→<code>tearDown()</code>固定流程。</li>
<li><strong>Android Activity</strong>：<code>onCreate()</code>→<code>onStart()</code>→<code>onResume()</code>生命周期模板。</li>
</ul>
<p><strong>优缺点</strong></p>
<table>
<thead>
<tr>
<th align="left"><strong>优点</strong></th>
<th align="left"><strong>缺点</strong></th>
</tr>
</thead>
<tbody><tr>
<td align="left">提高代码复用性</td>
<td align="left">每新增一个实现需创建子类</td>
</tr>
<tr>
<td align="left">便于维护核心流程</td>
<td align="left">继承关系可能带来耦合</td>
</tr>
<tr>
<td align="left">允许精细化扩展</td>
<td align="left">违反组合优于继承原则</td>
</tr>
</tbody></table>
<p>模板方法模式通过<strong>流程模板化</strong>和<strong>步骤延迟实现</strong>，为具有稳定结构但可变细节的操作提供了优雅的解决方案，是框架设计的常用模式。</p>
<h1 id="访问者模式"><a href="#访问者模式" class="headerlink" title="访问者模式"></a>访问者模式</h1><p><strong>产生背景</strong></p>
<ul>
<li><strong>复杂对象结构操作扩展</strong>：当系统包含<strong>复杂对象结构</strong>（如树形结构、集合元素），需要<strong>频繁添加新操作</strong>（如数据统计、格式转换），但<strong>不愿修改对象类</strong>（避免破坏开闭原则）。</li>
<li><strong>操作逻辑分散</strong>：若将不同操作硬编码到对象类中，会导致类职责膨胀、代码耦合度高。</li>
<li><strong>跨类统一处理</strong>：需对异构对象（如不同类型的UI控件）执行统一操作（如渲染、导出）。</li>
</ul>
<p>访问者模式（<strong>Visitor Pattern</strong>）是一种<strong>行为型设计模式</strong>，允许在不修改对象结构的前提下，<strong>定义作用于这些元素的新操作</strong>。<br>核心思想：<strong>将数据结构与数据操作分离</strong>，通过“访问者”对象集中实现跨对象的操作逻辑。</p>
<h2 id="作用-21"><a href="#作用-21" class="headerlink" title="作用"></a><strong>作用</strong></h2><ul>
<li><strong>解耦数据结构与操作</strong>：操作逻辑集中在访问者类中。</li>
<li><strong>灵活扩展操作</strong>：新增操作只需添加新的访问者类。</li>
<li><strong>统一异构对象处理</strong>：为不同类型元素提供统一操作接口。</li>
<li><strong>符合开闭原则</strong>：新增操作不修改元素类，但新增元素需修改所有访问者。</li>
</ul>
<h2 id="使用场景-21"><a href="#使用场景-21" class="headerlink" title="使用场景"></a><strong>使用场景</strong></h2><ul>
<li><strong>复杂对象结构遍历</strong>：如编译器抽象语法树（AST）的类型检查、代码生成。</li>
<li><strong>跨类型统一操作</strong>：如文档导出（将段落、图片转为HTML&#x2F;Markdown）。</li>
<li><strong>数据统计与报表</strong>：如计算电商订单总价、库存统计。</li>
<li><strong>UI框架渲染</strong>：遍历UI控件树进行布局、绘制。</li>
</ul>
<h2 id="经典简单实例-18"><a href="#经典简单实例-18" class="headerlink" title="经典简单实例"></a><strong>经典简单实例</strong></h2><h5 id="购物车价格计算"><a href="#购物车价格计算" class="headerlink" title="购物车价格计算"></a><strong>购物车价格计算</strong></h5><p>购物车包含不同类型的商品（书、水果），需支持两种操作：</p>
<ol>
<li><strong>计算总价格</strong></li>
<li><strong>计算税金</strong>（书税率为10%，水果免税）<br>通过访问者模式实现价格计算逻辑与商品类的解耦。</li>
</ol>
<p><strong>类结构设计</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1. 元素接口（定义接受访问者的方法）</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">ItemElement</span> &#123;</span><br><span class="line">    <span class="type">double</span> <span class="title function_">accept</span><span class="params">(Visitor visitor)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. 具体元素类：书</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Book</span> <span class="keyword">implements</span> <span class="title class_">ItemElement</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">double</span> price;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Book</span><span class="params">(<span class="type">double</span> price)</span> &#123; <span class="built_in">this</span>.price = price; &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">double</span> <span class="title function_">getPrice</span><span class="params">()</span> &#123; <span class="keyword">return</span> price; &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">double</span> <span class="title function_">accept</span><span class="params">(Visitor visitor)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> visitor.visit(<span class="built_in">this</span>); <span class="comment">// 将自身传递给访问者</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3. 具体元素类：水果</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Fruit</span> <span class="keyword">implements</span> <span class="title class_">ItemElement</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">double</span> pricePerKg;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">double</span> weight;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Fruit</span><span class="params">(<span class="type">double</span> pricePerKg, <span class="type">double</span> weight)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.pricePerKg = pricePerKg;</span><br><span class="line">        <span class="built_in">this</span>.weight = weight;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">double</span> <span class="title function_">getTotalPrice</span><span class="params">()</span> &#123; <span class="keyword">return</span> pricePerKg * weight; &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">double</span> <span class="title function_">accept</span><span class="params">(Visitor visitor)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> visitor.visit(<span class="built_in">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 4. 访问者接口（定义访问方法）</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">Visitor</span> &#123;</span><br><span class="line">    <span class="type">double</span> <span class="title function_">visit</span><span class="params">(Book book)</span>;</span><br><span class="line">    <span class="type">double</span> <span class="title function_">visit</span><span class="params">(Fruit fruit)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 5. 具体访问者：价格计算器</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">PriceCalculator</span> <span class="keyword">implements</span> <span class="title class_">Visitor</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">double</span> <span class="title function_">visit</span><span class="params">(Book book)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> book.getPrice();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">double</span> <span class="title function_">visit</span><span class="params">(Fruit fruit)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> fruit.getTotalPrice();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 6. 具体访问者：税金计算器</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">TaxCalculator</span> <span class="keyword">implements</span> <span class="title class_">Visitor</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">double</span> <span class="title function_">visit</span><span class="params">(Book book)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> book.getPrice() * <span class="number">0.10</span>; <span class="comment">// 书税10%</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">double</span> <span class="title function_">visit</span><span class="params">(Fruit fruit)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>; <span class="comment">// 水果免税</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 客户端调用</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Client</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        ItemElement[] items = &#123;</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">Book</span>(<span class="number">100</span>),</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">Fruit</span>(<span class="number">20</span>, <span class="number">2</span>) <span class="comment">// 单价20元/kg，重量2kg</span></span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        <span class="type">Visitor</span> <span class="variable">priceVisitor</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PriceCalculator</span>();</span><br><span class="line">        <span class="type">Visitor</span> <span class="variable">taxVisitor</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TaxCalculator</span>();</span><br><span class="line"></span><br><span class="line">        <span class="type">double</span> <span class="variable">totalPrice</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="type">double</span> <span class="variable">totalTax</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (ItemElement item : items) &#123;</span><br><span class="line">            totalPrice += item.accept(priceVisitor);</span><br><span class="line">            totalTax += item.accept(taxVisitor);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;总价格: &quot;</span> + totalPrice); <span class="comment">// 100 + 40 = 140</span></span><br><span class="line">        System.out.println(<span class="string">&quot;总税金: &quot;</span> + totalTax);   <span class="comment">// 10 + 0 = 10</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>关键点</strong></p>
<ul>
<li><strong>双分派（Double Dispatch）</strong>：通过两次动态绑定（元素→访问者→具体方法）实现多态。</li>
<li><strong>元素接口稳定性</strong>：若频繁新增元素类型（如新增<code>Electronics</code>类），需修改所有访问者接口，破坏开闭原则。</li>
<li><strong>访问者状态管理</strong>：访问者可在内部累积计算结果（如总价格），无需客户端遍历时累加。</li>
<li><strong>与迭代器模式结合</strong>：通常需要遍历对象结构并应用访问者。</li>
</ul>
<p><strong>实际应用</strong></p>
<ul>
<li><strong>Java注解处理</strong>：<code>AnnotationProcessor</code>访问编译期注解。</li>
<li><strong>ASM字节码框架</strong>：<code>ClassVisitor</code>遍历并修改类结构。</li>
<li><strong>XML解析器</strong>：访问DOM树节点生成JSON或HTML。</li>
<li><strong>游戏引擎</strong>：遍历场景图计算光照、碰撞检测。</li>
</ul>
<p><strong>优缺点</strong></p>
<table>
<thead>
<tr>
<th align="left"><strong>优点</strong></th>
<th align="left"><strong>缺点</strong></th>
</tr>
</thead>
<tbody><tr>
<td align="left">集中化操作逻辑，提高可维护性</td>
<td align="left">新增元素类型需修改所有访问者</td>
</tr>
<tr>
<td align="left">轻松扩展新操作</td>
<td align="left">破坏元素类的封装性（需公开内部状态）</td>
</tr>
<tr>
<td align="left">适合稳定数据结构+频繁操作变更</td>
<td align="left">增加系统复杂度</td>
</tr>
</tbody></table>
<p>访问者模式通过<strong>操作外部化</strong>和<strong>双分派机制</strong>，为复杂对象结构的操作扩展提供了独特解决方案，是处理横切关注点（Cross-Cutting Concerns）的利器。</p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="https://TroublingRainBlue.github.io">XYJ</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://troublingrainblue.github.io/2025/04/05/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/">https://troublingrainblue.github.io/2025/04/05/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://TroublingRainBlue.github.io" target="_blank">XYJ</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/java/">java</a><a class="post-meta__tags" href="/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/">设计模式</a></div><div class="post_share"><div class="social-share" data-image="https://cdn.acwing.com/media/article/image/2025/04/05/104918_97006f7411-b_f45a1ac4a80690a8b277e50e05c5ddf7.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2025/04/08/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/" title="机器学习入门"><img class="cover" src="/img/109989533_p0_master1200.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">机器学习入门</div></div></a></div><div class="next-post pull-right"><a href="/2025/01/23/zookeeper/" title="zookeeper"><img class="cover" src="/img/51160511_p0_master1200.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">zookeeper</div></div></a></div></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/img/favicon.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">XYJ</div><div class="author-info__description"></div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">30</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">17</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">11</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/TroublingRainBlue"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/TroublingRainBlue" target="_blank" title="Github"><i class="fab fa-github" style="color: #24292e;"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">加油</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BB%80%E4%B9%88%E6%98%AF%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%E7%BC%96%E7%A8%8B%EF%BC%9F"><span class="toc-number">1.</span> <span class="toc-text">什么是面向对象编程？</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%E7%9A%84%E5%9B%9B%E5%A4%A7%E7%89%B9%E6%80%A7"><span class="toc-number">1.1.</span> <span class="toc-text">面向对象的四大特性</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B0%81%E8%A3%85"><span class="toc-number">1.1.1.</span> <span class="toc-text">封装</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8A%BD%E8%B1%A1"><span class="toc-number">1.1.2.</span> <span class="toc-text">抽象</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BB%A7%E6%89%BF"><span class="toc-number">1.1.3.</span> <span class="toc-text">继承</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%9A%E6%80%81"><span class="toc-number">1.1.4.</span> <span class="toc-text">多态</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8A%BD%E8%B1%A1%E7%B1%BB%E5%92%8C%E6%8E%A5%E5%8F%A3"><span class="toc-number">1.2.</span> <span class="toc-text">抽象类和接口</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8A%BD%E8%B1%A1%E7%B1%BB"><span class="toc-number">1.2.1.</span> <span class="toc-text">抽象类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8E%A5%E5%8F%A3%E7%89%B9%E6%80%A7"><span class="toc-number">1.2.2.</span> <span class="toc-text">接口特性</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF"><span class="toc-number">1.2.3.</span> <span class="toc-text">应用场景</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9F%BA%E4%BA%8E%E6%8E%A5%E5%8F%A3%E8%80%8C%E9%9D%9E%E5%AE%9E%E7%8E%B0%E7%BC%96%E7%A8%8B"><span class="toc-number">1.2.4.</span> <span class="toc-text">基于接口而非实现编程</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E4%B8%8D%E6%8E%A8%E8%8D%90%E4%BD%BF%E7%94%A8%E7%BB%A7%E6%89%BF"><span class="toc-number">1.3.</span> <span class="toc-text">为什么不推荐使用继承</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E7%9A%84%E5%85%AD%E5%A4%A7%E5%8E%9F%E5%88%99"><span class="toc-number">2.</span> <span class="toc-text">设计模式的六大原则</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%B7%A5%E5%8E%82%E6%A8%A1%E5%BC%8F"><span class="toc-number">3.</span> <span class="toc-text">工厂模式</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AE%80%E5%8D%95%E5%B7%A5%E5%8E%82%E6%A8%A1%E5%BC%8F"><span class="toc-number">3.1.</span> <span class="toc-text">简单工厂模式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B7%A5%E5%8E%82%E6%96%B9%E6%B3%95%E6%A8%A1%E5%BC%8F"><span class="toc-number">3.2.</span> <span class="toc-text">工厂方法模式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%9C%E7%94%A8"><span class="toc-number">3.3.</span> <span class="toc-text">作用</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E5%9C%BA%E6%99%AF"><span class="toc-number">3.4.</span> <span class="toc-text">使用场景</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%8A%BD%E8%B1%A1%E5%B7%A5%E5%8E%82%E6%A8%A1%E5%BC%8F"><span class="toc-number">4.</span> <span class="toc-text">抽象工厂模式</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B7%A5%E5%8E%82%E6%96%B9%E6%B3%95%E6%A8%A1%E5%BC%8F%E4%B8%8E%E6%8A%BD%E8%B1%A1%E5%B7%A5%E5%8E%82%E5%AF%B9%E6%AF%94"><span class="toc-number">4.1.</span> <span class="toc-text">工厂方法模式与抽象工厂对比</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B7%A5%E5%8E%82%E6%96%B9%E6%B3%95%E6%A8%A1%E5%BC%8F-1"><span class="toc-number">4.1.1.</span> <span class="toc-text">工厂方法模式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8A%BD%E8%B1%A1%E5%B7%A5%E5%8E%82%E6%A8%A1%E5%BC%8F-1"><span class="toc-number">4.1.2.</span> <span class="toc-text">抽象工厂模式</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8F"><span class="toc-number">5.</span> <span class="toc-text">单例模式</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%A5%BF%E6%B1%89%E5%BC%8F%E5%8D%95%E4%BE%8B"><span class="toc-number">5.1.</span> <span class="toc-text">饿汉式单例</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%87%92%E6%B1%89%E5%BC%8F%E5%8D%95%E4%BE%8B"><span class="toc-number">5.2.</span> <span class="toc-text">懒汉式单例</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%8C%E9%87%8D%E9%94%81%E6%A3%80%E6%9F%A5"><span class="toc-number">5.2.1.</span> <span class="toc-text">双重锁检查</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%99%BB%E8%AE%B0%E5%BC%8F-%E9%9D%99%E6%80%81%E5%86%85%E9%83%A8%E7%B1%BB"><span class="toc-number">5.2.2.</span> <span class="toc-text">登记式&#x2F;静态内部类</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%89%E7%A7%8D%E5%AE%9E%E7%8E%B0%E6%96%B9%E5%BC%8F%E5%AF%B9%E6%AF%94"><span class="toc-number">5.3.</span> <span class="toc-text">三种实现方式对比</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%9C%E7%94%A8-1"><span class="toc-number">5.4.</span> <span class="toc-text">作用</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E5%9C%BA%E6%99%AF-1"><span class="toc-number">5.5.</span> <span class="toc-text">使用场景</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%BB%BA%E9%80%A0%E8%80%85%E6%A8%A1%E5%BC%8F"><span class="toc-number">6.</span> <span class="toc-text">建造者模式</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%9C%E7%94%A8-2"><span class="toc-number">6.1.</span> <span class="toc-text">作用</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E5%9C%BA%E6%99%AF-2"><span class="toc-number">6.2.</span> <span class="toc-text">使用场景</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A1%88%E4%BE%8B"><span class="toc-number">6.3.</span> <span class="toc-text">案例</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%8E%E4%BC%A0%E7%BB%9F%E6%9E%84%E9%80%A0%E6%96%B9%E5%BC%8F%E5%AF%B9%E6%AF%94"><span class="toc-number">6.4.</span> <span class="toc-text">与传统构造方式对比</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%8E%9F%E5%9E%8B%E6%A8%A1%E5%BC%8F"><span class="toc-number">7.</span> <span class="toc-text">原型模式</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%9C%E7%94%A8-3"><span class="toc-number">7.1.</span> <span class="toc-text">作用</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E5%9C%BA%E6%99%AF-3"><span class="toc-number">7.2.</span> <span class="toc-text">使用场景</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BB%8F%E5%85%B8%E7%AE%80%E5%8D%95%E5%AE%9E%E4%BE%8B"><span class="toc-number">7.3.</span> <span class="toc-text">经典简单实例</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B7%B1%E6%8B%B7%E8%B4%9D%E4%B8%8E%E6%B5%85%E6%8B%B7%E8%B4%9D"><span class="toc-number">7.4.</span> <span class="toc-text">深拷贝与浅拷贝</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AF%B9%E6%AF%94%E5%85%B6%E4%BB%96%E5%88%9B%E5%BB%BA%E5%9E%8B%E6%A8%A1%E5%BC%8F"><span class="toc-number">7.5.</span> <span class="toc-text">对比其他创建型模式</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E9%80%82%E9%85%8D%E5%99%A8%E6%A8%A1%E5%BC%8F"><span class="toc-number">8.</span> <span class="toc-text">适配器模式</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%9C%E7%94%A8-4"><span class="toc-number">8.1.</span> <span class="toc-text">作用</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E5%9C%BA%E6%99%AF-4"><span class="toc-number">8.2.</span> <span class="toc-text">使用场景</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BB%8F%E5%85%B8%E7%AE%80%E5%8D%95%E5%AE%9E%E4%BE%8B-1"><span class="toc-number">8.3.</span> <span class="toc-text">经典简单实例</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%B1%BB%E9%80%82%E9%85%8D%E5%99%A8-vs-%E5%AF%B9%E8%B1%A1%E9%80%82%E9%85%8D%E5%99%A8"><span class="toc-number">8.4.</span> <span class="toc-text">类适配器 vs 对象适配器</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%9E%E9%99%85%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF"><span class="toc-number">8.5.</span> <span class="toc-text">实际应用场景</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%A1%A5%E6%8E%A5%E6%A8%A1%E5%BC%8F"><span class="toc-number">9.</span> <span class="toc-text">桥接模式</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%9C%E7%94%A8-5"><span class="toc-number">9.1.</span> <span class="toc-text">作用</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E5%9C%BA%E6%99%AF-5"><span class="toc-number">9.2.</span> <span class="toc-text">使用场景</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BB%8F%E5%85%B8%E7%AE%80%E5%8D%95%E5%AE%9E%E4%BE%8B-2"><span class="toc-number">9.3.</span> <span class="toc-text">经典简单实例</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%9E%E9%99%85%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF-1"><span class="toc-number">9.4.</span> <span class="toc-text">实际应用场景</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%BB%84%E5%90%88%E6%A8%A1%E5%BC%8F"><span class="toc-number">10.</span> <span class="toc-text">组合模式</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%9C%E7%94%A8-6"><span class="toc-number">10.1.</span> <span class="toc-text">作用</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E5%9C%BA%E6%99%AF-6"><span class="toc-number">10.2.</span> <span class="toc-text">使用场景</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BB%8F%E5%85%B8%E7%AE%80%E5%8D%95%E5%AE%9E%E4%BE%8B-3"><span class="toc-number">10.3.</span> <span class="toc-text">经典简单实例</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%A3%85%E9%A5%B0%E5%99%A8%E6%A8%A1%E5%BC%8F"><span class="toc-number">11.</span> <span class="toc-text">装饰器模式</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%9C%E7%94%A8-7"><span class="toc-number">11.1.</span> <span class="toc-text">作用</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E5%9C%BA%E6%99%AF-7"><span class="toc-number">11.2.</span> <span class="toc-text">使用场景</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BB%8F%E5%85%B8%E7%AE%80%E5%8D%95%E5%AE%9E%E4%BE%8B-4"><span class="toc-number">11.3.</span> <span class="toc-text">经典简单实例</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BB%A3%E7%90%86%E6%A8%A1%E5%BC%8F"><span class="toc-number">12.</span> <span class="toc-text">代理模式</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%9C%E7%94%A8-8"><span class="toc-number">12.1.</span> <span class="toc-text">作用</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E5%9C%BA%E6%99%AF-8"><span class="toc-number">12.2.</span> <span class="toc-text">使用场景</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BB%8F%E5%85%B8%E7%AE%80%E5%8D%95%E5%AE%9E%E4%BE%8B-5"><span class="toc-number">12.3.</span> <span class="toc-text">经典简单实例</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8A%A8%E6%80%81%E4%BB%A3%E7%90%86"><span class="toc-number">12.4.</span> <span class="toc-text">动态代理</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9A%E4%B9%89%E7%9B%AE%E6%A0%87%E6%8E%A5%E5%8F%A3"><span class="toc-number">12.4.1.</span> <span class="toc-text">定义目标接口</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9E%E7%8E%B0%E7%9B%AE%E6%A0%87%E7%B1%BB"><span class="toc-number">12.4.2.</span> <span class="toc-text">实现目标类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9E%E7%8E%B0InvocationHandler"><span class="toc-number">12.4.3.</span> <span class="toc-text">实现InvocationHandler</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%94%9F%E6%88%90%E5%8A%A8%E6%80%81%E4%BB%A3%E7%90%86%E5%AF%B9%E8%B1%A1"><span class="toc-number">12.4.4.</span> <span class="toc-text">生成动态代理对象</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8A%A8%E6%80%81%E4%BB%A3%E7%90%86-vs-%E9%9D%99%E6%80%81%E4%BB%A3%E7%90%86"><span class="toc-number">12.5.</span> <span class="toc-text">动态代理 vs 静态代理</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%A4%96%E8%A7%82%E6%A8%A1%E5%BC%8F"><span class="toc-number">13.</span> <span class="toc-text">外观模式</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%9C%E7%94%A8-9"><span class="toc-number">13.1.</span> <span class="toc-text">作用</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E5%9C%BA%E6%99%AF-9"><span class="toc-number">13.2.</span> <span class="toc-text">使用场景</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BB%8F%E5%85%B8%E7%AE%80%E5%8D%95%E5%AE%9E%E4%BE%8B-6"><span class="toc-number">13.3.</span> <span class="toc-text">经典简单实例</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BA%AB%E5%85%83%E6%A8%A1%E5%BC%8F"><span class="toc-number">14.</span> <span class="toc-text">享元模式</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%9C%E7%94%A8-10"><span class="toc-number">14.1.</span> <span class="toc-text">作用</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E5%9C%BA%E6%99%AF-10"><span class="toc-number">14.2.</span> <span class="toc-text">使用场景</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BB%8F%E5%85%B8%E7%AE%80%E5%8D%95%E5%AE%9E%E4%BE%8B-7"><span class="toc-number">14.3.</span> <span class="toc-text">经典简单实例</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AF%B9%E6%AF%94%E5%85%B6%E4%BB%96%E6%A8%A1%E5%BC%8F"><span class="toc-number">14.4.</span> <span class="toc-text">对比其他模式</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%B4%A3%E4%BB%BB%E9%93%BE%E6%A8%A1%E5%BC%8F"><span class="toc-number">15.</span> <span class="toc-text">责任链模式</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%9C%E7%94%A8-11"><span class="toc-number">15.1.</span> <span class="toc-text">作用</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E5%9C%BA%E6%99%AF-11"><span class="toc-number">15.2.</span> <span class="toc-text">使用场景</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BB%8F%E5%85%B8%E7%AE%80%E5%8D%95%E5%AE%9E%E4%BE%8B-8"><span class="toc-number">15.3.</span> <span class="toc-text">经典简单实例</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%91%BD%E4%BB%A4%E6%A8%A1%E5%BC%8F"><span class="toc-number">16.</span> <span class="toc-text">命令模式</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%9C%E7%94%A8-12"><span class="toc-number">16.1.</span> <span class="toc-text">作用</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E5%9C%BA%E6%99%AF-12"><span class="toc-number">16.2.</span> <span class="toc-text">使用场景</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BB%8F%E5%85%B8%E7%AE%80%E5%8D%95%E5%AE%9E%E4%BE%8B-9"><span class="toc-number">16.3.</span> <span class="toc-text">经典简单实例</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%A7%A3%E9%87%8A%E5%99%A8%E6%A8%A1%E5%BC%8F"><span class="toc-number">17.</span> <span class="toc-text">解释器模式</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%9C%E7%94%A8-13"><span class="toc-number">17.1.</span> <span class="toc-text">作用</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E5%9C%BA%E6%99%AF-13"><span class="toc-number">17.2.</span> <span class="toc-text">使用场景</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BB%8F%E5%85%B8%E7%AE%80%E5%8D%95%E5%AE%9E%E4%BE%8B-10"><span class="toc-number">17.3.</span> <span class="toc-text">经典简单实例</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%BF%AD%E4%BB%A3%E5%99%A8%E6%A8%A1%E5%9E%8B"><span class="toc-number">18.</span> <span class="toc-text">迭代器模型</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%9C%E7%94%A8-14"><span class="toc-number">18.1.</span> <span class="toc-text">作用</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E5%9C%BA%E6%99%AF-14"><span class="toc-number">18.2.</span> <span class="toc-text">使用场景</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BB%8F%E5%85%B8%E7%AE%80%E5%8D%95%E5%AE%9E%E4%BE%8B-11"><span class="toc-number">18.3.</span> <span class="toc-text">经典简单实例</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%AD%E4%BB%8B%E8%80%85%E6%A8%A1%E5%BC%8F"><span class="toc-number">19.</span> <span class="toc-text">中介者模式</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%9C%E7%94%A8-15"><span class="toc-number">19.1.</span> <span class="toc-text">作用</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E5%9C%BA%E6%99%AF-15"><span class="toc-number">19.2.</span> <span class="toc-text">使用场景</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BB%8F%E5%85%B8%E7%AE%80%E5%8D%95%E5%AE%9E%E4%BE%8B-12"><span class="toc-number">19.3.</span> <span class="toc-text">经典简单实例</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%A4%87%E5%BF%98%E5%BD%95%E6%A8%A1%E5%BC%8F"><span class="toc-number">20.</span> <span class="toc-text">备忘录模式</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%9C%E7%94%A8-16"><span class="toc-number">20.1.</span> <span class="toc-text">作用</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E5%9C%BA%E6%99%AF-16"><span class="toc-number">20.2.</span> <span class="toc-text">使用场景</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BB%8F%E5%85%B8%E7%AE%80%E5%8D%95%E5%AE%9E%E4%BE%8B-13"><span class="toc-number">20.3.</span> <span class="toc-text">经典简单实例</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%A7%82%E5%AF%9F%E8%80%85%E6%A8%A1%E5%BC%8F"><span class="toc-number">21.</span> <span class="toc-text">观察者模式</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%9C%E7%94%A8-17"><span class="toc-number">21.1.</span> <span class="toc-text">作用</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E5%9C%BA%E6%99%AF-17"><span class="toc-number">21.2.</span> <span class="toc-text">使用场景</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BB%8F%E5%85%B8%E7%AE%80%E5%8D%95%E5%AE%9E%E4%BE%8B-14"><span class="toc-number">21.3.</span> <span class="toc-text">经典简单实例</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%8A%B6%E6%80%81%E6%A8%A1%E5%BC%8F"><span class="toc-number">22.</span> <span class="toc-text">状态模式</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%9C%E7%94%A8-18"><span class="toc-number">22.1.</span> <span class="toc-text">作用</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E5%9C%BA%E6%99%AF-18"><span class="toc-number">22.2.</span> <span class="toc-text">使用场景</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BB%8F%E5%85%B8%E7%AE%80%E5%8D%95%E5%AE%9E%E4%BE%8B-15"><span class="toc-number">22.3.</span> <span class="toc-text">经典简单实例</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%AD%96%E7%95%A5%E6%A8%A1%E5%BC%8F"><span class="toc-number">23.</span> <span class="toc-text">策略模式</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%9C%E7%94%A8-19"><span class="toc-number">23.1.</span> <span class="toc-text">作用</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E5%9C%BA%E6%99%AF-19"><span class="toc-number">23.2.</span> <span class="toc-text">使用场景</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BB%8F%E5%85%B8%E7%AE%80%E5%8D%95%E5%AE%9E%E4%BE%8B-16"><span class="toc-number">23.3.</span> <span class="toc-text">经典简单实例</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%A8%A1%E6%9D%BF%E6%96%B9%E6%B3%95%E6%A8%A1%E5%BC%8F"><span class="toc-number">24.</span> <span class="toc-text">模板方法模式</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%9C%E7%94%A8-20"><span class="toc-number">24.1.</span> <span class="toc-text">作用</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E5%9C%BA%E6%99%AF-20"><span class="toc-number">24.2.</span> <span class="toc-text">使用场景</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BB%8F%E5%85%B8%E7%AE%80%E5%8D%95%E5%AE%9E%E4%BE%8B-17"><span class="toc-number">24.3.</span> <span class="toc-text">经典简单实例</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%AE%BF%E9%97%AE%E8%80%85%E6%A8%A1%E5%BC%8F"><span class="toc-number">25.</span> <span class="toc-text">访问者模式</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%9C%E7%94%A8-21"><span class="toc-number">25.1.</span> <span class="toc-text">作用</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E5%9C%BA%E6%99%AF-21"><span class="toc-number">25.2.</span> <span class="toc-text">使用场景</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BB%8F%E5%85%B8%E7%AE%80%E5%8D%95%E5%AE%9E%E4%BE%8B-18"><span class="toc-number">25.3.</span> <span class="toc-text">经典简单实例</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%B4%AD%E7%89%A9%E8%BD%A6%E4%BB%B7%E6%A0%BC%E8%AE%A1%E7%AE%97"><span class="toc-number">25.3.0.0.1.</span> <span class="toc-text">购物车价格计算</span></a></li></ol></li></ol></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2025/04/11/JVM-%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86%E2%80%94%E2%80%94Java%E5%86%85%E5%AD%98%E5%8C%BA%E5%9F%9F/" title="JVM 自动内存管理"><img src="https://cdn.acwing.com/media/article/image/2025/04/11/104918_2d5a04dc16-QQ20250411-083019.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="JVM 自动内存管理"/></a><div class="content"><a class="title" href="/2025/04/11/JVM-%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86%E2%80%94%E2%80%94Java%E5%86%85%E5%AD%98%E5%8C%BA%E5%9F%9F/" title="JVM 自动内存管理">JVM 自动内存管理</a><time datetime="2025-04-11T00:20:14.000Z" title="发表于 2025-04-11 08:20:14">2025-04-11</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/04/08/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/" title="机器学习入门"><img src="/img/109989533_p0_master1200.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="机器学习入门"/></a><div class="content"><a class="title" href="/2025/04/08/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/" title="机器学习入门">机器学习入门</a><time datetime="2025-04-08T10:15:11.000Z" title="发表于 2025-04-08 18:15:11">2025-04-08</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/04/05/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" title="设计模式"><img src="https://cdn.acwing.com/media/article/image/2025/04/05/104918_97006f7411-b_f45a1ac4a80690a8b277e50e05c5ddf7.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="设计模式"/></a><div class="content"><a class="title" href="/2025/04/05/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" title="设计模式">设计模式</a><time datetime="2025-04-05T04:26:19.000Z" title="发表于 2025-04-05 12:26:19">2025-04-05</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/01/23/zookeeper/" title="zookeeper"><img src="/img/51160511_p0_master1200.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="zookeeper"/></a><div class="content"><a class="title" href="/2025/01/23/zookeeper/" title="zookeeper">zookeeper</a><time datetime="2025-01-23T04:36:35.000Z" title="发表于 2025-01-23 12:36:35">2025-01-23</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/08/08/%E6%89%8B%E6%92%B8RPC/" title="手撸RPC框架"><img src="/img/XYJ1169080555732136.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="手撸RPC框架"/></a><div class="content"><a class="title" href="/2024/08/08/%E6%89%8B%E6%92%B8RPC/" title="手撸RPC框架">手撸RPC框架</a><time datetime="2024-08-08T01:05:01.000Z" title="发表于 2024-08-08 09:05:01">2024-08-08</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2025 By XYJ</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page/instantpage.min.js" type="module"></script><div class="js-pjax"><script>if (!window.MathJax) {
  window.MathJax = {
    tex: {
      inlineMath: [['$', '$'], ['\\(', '\\)']],
      tags: 'ams'
    },
    chtml: {
      scale: 1.1
    },
    options: {
      renderActions: {
        findScript: [10, doc => {
          for (const node of document.querySelectorAll('script[type^="math/tex"]')) {
            const display = !!node.type.match(/; *mode=display/)
            const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display)
            const text = document.createTextNode('')
            node.parentNode.replaceChild(text, node)
            math.start = {node: text, delim: '', n: 0}
            math.end = {node: text, delim: '', n: 0}
            doc.math.push(math)
          }
        }, '']
      }
    }
  }
  
  const script = document.createElement('script')
  script.src = 'https://cdn.jsdelivr.net/npm/mathjax/es5/tex-mml-chtml.min.js'
  script.id = 'MathJax-script'
  script.async = true
  document.head.appendChild(script)
} else {
  MathJax.startup.document.state(0)
  MathJax.texReset()
  MathJax.typesetPromise()
}</script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/katex/dist/katex.min.css"><script src="https://cdn.jsdelivr.net/npm/katex/dist/contrib/copy-tex.min.js"></script><script>(() => {
  document.querySelectorAll('#article-container span.katex-display').forEach(item => {
    btf.wrap(item, 'div', { class: 'katex-wrap'})
  })
})()</script></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>